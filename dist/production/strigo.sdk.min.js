(()=>{var De="strigo-sdk",Ne="strigo.io",Ge="localhost:3000",be=["strigo-exercises"],ze=["orig-iframe"],ue=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"/></svg>
`,Pe=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"/></svg>
`,N="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk";function Vt(t){let e={};for(let[r,o]of t)e[r]=o;return e}function Wt(t){let r=new URLSearchParams(t).entries();return Vt(r)}function Fe(){let{host:t,pathname:e,href:r,origin:o,search:g}=window.location;return{host:t,pathName:e,href:r,origin:o,search:g,params:Wt(g)}}function U(t){let{subDomain:e,token:r,webApiKey:o,development:g}=t;return g?`http://${Ge}/academy/courses?token=${r.token}&webApiKey=${o}`:`https://${e}.${Ne}/academy/courses?token=${r.token}&webApiKey=${o}`}function Ve(){let t=document.getElementById(De);return{webApiKey:t?.getAttribute("data-web-api-key")||"",subDomain:t?.getAttribute("data-subdomain")||"",selectedWidgetFlavor:t?.getAttribute("data-layout-flavor")||"dynamic"}}function We(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:e?`${N}@${e}/dist/production/styles/strigo.min.css`:`${N}@master/dist/production/styles/strigo.min.css`}function He(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo-widget.css`:e?`${N}@${e}/dist/production/styles/strigo-widget.min.css`:`${N}@master/dist/production/styles/strigo-widget.min.css`}var ke=class{constructor(e){this.url=e?.url}setup(e){this.url=e.url}logToRemote(e,r,o){return fetch(this.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:r,context:o})}).then(g=>{g.ok||console.warn("Logging to Strigo failed",{result:g})}).catch(g=>{console.warn("Logging to Strigo failed",{err:g})})}logToConsole(e,r,o){let g=`${new Date().toISOString()} - ${r}`;console[e](g,o?`
${JSON.stringify(o)}`:"")}getDefaultContext(){let e=p();if(!e)return{};let{token:r,subDomain:o,initSite:g,development:l,version:E,selectedWidgetFlavor:O}=e;return{token:r.token,initSite:g.href,subDomain:o,development:l,version:E,selectedWidgetFlavor:O}}log(e,r,o){let g={...this.getDefaultContext(),...o};try{this.url&&!p()?.development&&this.logToRemote(e,r,g),this.logToConsole(e,`Academy - ${r}`,g)}catch(l){console.log("Logging error:",{err:l})}}debug(e,r={}){this.log("debug",e,r)}info(e,r={}){this.log("info",e,r)}warn(e,r={}){this.log("warn",e,r)}error(e,r={}){this.log("error",e,r)}},c=new ke;function b(t,e){try{return JSON.parse(window[t].getItem(e))}catch(r){return c.error("get storage data error",{err:r}),null}}function B(t,e,r){try{return window[t].setItem(e,JSON.stringify(r)),r}catch(o){return c.error("setup storage error",{err:o}),null}}function Se(t,e,r,o){try{let g=b(t,e);if(!g)throw new Error("Can't find initial state");let l={...g,[r]:o};return window[t].setItem(e,JSON.stringify(l)),l}catch(g){return c.error("set storage value error",{err:g}),null}}function Y(t,e){try{window[t].removeItem(e)}catch(r){c.error("clear storage error",{err:r})}}function Ue(t){return B("localStorage","strigoConfig",t)}function p(){return b("localStorage","strigoConfig")}function Be(t){return p()?.[t]}function Ye(){Y("localStorage","strigoConfig")}async function $e(t,e){try{let o=await fetch(`${e?"http://localhost:3000":"https://app.strigo.io"}/api/internal/academy/v1/config`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}});if(!o.ok)throw new Error(`Failed to fetch remote configuration: ${o.statusText}`);return(await o.json()).data}catch(r){return c.warn("Error fetching configuration from Strigo",{err:r}),null}}function Je(t){return B("sessionStorage","strigoSession",t)}function ve(){return b("sessionStorage","strigoSession")}function $(){return ve()?.isPanelOpen}function R(){return ve()?.widgetFlavor}function Ee(t,e){return Se("sessionStorage","strigoSession",t,e)}function je(t){return ve()?.[t]}function qe(){Y("sessionStorage","strigoSession")}function he(){Ee("isPanelOpen",!1)}window.onunload=function(){he()};function J(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(t){return c.error("Get events storage error",{error:t}),null}}function Xe(){try{let t=J();if(t)return c.debug("Events storage already exists"),t;let e={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),e}catch(t){return c.error("Init events storage error",{error:t}),null}}function Ze(t){try{let e=J();if(!e)throw new Error("Can't find initial state");let r=JSON.stringify(e);if(e.events.push(t),window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),R()==="overlay"){let o=new CustomEvent("overlay-widget-event",{bubbles:!0,detail:{key:"strigoEvents",oldValue:r,newValue:JSON.stringify(e)}});window.dispatchEvent(o)}return e}catch(e){return c.error("Push event to storage error",{error:e}),null}}function Qe(){try{let t=J();if(!t)throw new Error("Can't find events storage");let e=t.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),e}catch(t){return c.error("Pop event from storage error",{error:t}),null}}function ye(){try{let t=J();if(!t)throw new Error("Can't find events storage");return t.events.pop()}catch(t){return c.error("Get event from storage error",{error:t}),null}}function j(){return document.getElementsByTagName("head")[0]}function tt(){document.open(),document.close()}function rt(){let t=document.createElement("div");return t.className="strigo-main",document.body.appendChild(t),t}function q(t){let{url:e,parentElement:r}=t,o=document.createElement("link");o.rel="stylesheet",o.href=e,r.appendChild(o)}function Te(t){let{url:e,parentElement:r,classNames:o,id:g}=t,l=document.createElement("iframe");return l.classList.add(...o),l.id=g,l.src=e,r.appendChild(l),l}function nt(){location.reload()}function ot(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function it(){return ot()?[window.screen.width,window.screen.width]:[window.screen.width/2,window.screen.width]}function st(){return ot()?[0,0]:[window.screen.width*.25,0]}function at(){let t=new XMLHttpRequest;t.open("GET",window.document.location.href,!1),t.send(null);let r=t.getAllResponseHeaders().toLowerCase().split(`\r
`);for(let o of r)if(o.includes("x-frame-options")){let g=o.split(":");if(g&&g.length>1)return g[1].trim()!=="deny"}return!0}function Ht(){let t=document.getElementById("strigo-widget"),e=t.classList.contains("slide-in");t.classList.toggle("slide-in"),setTimeout(()=>{let r=document.getElementById("strigo-arrow");r.innerHTML=e?Pe:ue},300)}function gt(t){let e=document.createElement("div");e.className="strigo-arrow",e.id="strigo-arrow",e.innerHTML=ue;let r=document.createElement("div");r.className="strigo-collapse-button",r.id="strigo-toggle",r.appendChild(e);let o=document.createElement("div");o.className="strigo-collapse-div",o.onclick=()=>{Ht()},o.appendChild(r);let g=document.createElement("iframe");g.className="strigo-iframe",g.id="strigo-exercises",g.src=t;let l=document.createElement("div");return l.id="strigo-widget",l.appendChild(o),l.appendChild(g),document.body.appendChild(l),g}function ct(){document.getElementById("strigo-widget").remove()}function lt(){let t=document.getElementById("strigo-widget");t.classList.contains("slide-in")||t.classList.add("slide-in")}var v=typeof window!="undefined"?window:null,Ie=v===null,F=Ie?void 0:v.document,h="addEventListener",w="removeEventListener",Oe="getBoundingClientRect",P="_a",y="_b",I="_c",X="horizontal",T=function(){return!1},kt=Ie?"calc":["","-webkit-","-moz-","-o-"].filter(function(t){var e=F.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",ft=function(t){return typeof t=="string"||t instanceof String},ut=function(t){if(ft(t)){var e=F.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},m=function(t,e,r){var o=t[e];return o!==void 0?o:r},Z=function(t,e,r,o){if(e){if(o==="end")return 0;if(o==="center")return t/2}else if(r){if(o==="start")return 0;if(o==="center")return t/2}return t},Kt=function(t,e){var r=F.createElement("div");return r.className="gutter gutter-"+e,r},Ut=function(t,e,r){var o={};return ft(e)?o[t]=e:o[t]=kt+"("+e+"% - "+r+"px)",o},Bt=function(t,e){var r;return r={},r[t]=e+"px",r},Yt=function(t,e){if(e===void 0&&(e={}),Ie)return{};var r=t,o,g,l,E,O,d;Array.from&&(r=Array.from(r));var _=ut(r[0]),L=_.parentNode,oe=getComputedStyle?getComputedStyle(L):null,V=oe?oe.flexDirection:null,ie=m(e,"sizes")||r.map(function(){return 100/r.length}),se=m(e,"minSize",100),ae=Array.isArray(se)?se:r.map(function(){return se}),ge=m(e,"maxSize",1/0),xt=Array.isArray(ge)?ge:r.map(function(){return ge}),Rt=m(e,"expandToMin",!1),M=m(e,"gutterSize",10),W=m(e,"gutterAlign","center"),ce=m(e,"snapOffset",30),At=Array.isArray(ce)?ce:r.map(function(){return ce}),le=m(e,"dragInterval",1),A=m(e,"direction",X),de=m(e,"cursor",A===X?"col-resize":"row-resize"),_t=m(e,"gutter",Kt),Ce=m(e,"elementStyle",Ut),Mt=m(e,"gutterStyle",Bt);A===X?(o="width",g="clientX",l="left",E="right",O="clientWidth"):A==="vertical"&&(o="height",g="clientY",l="top",E="bottom",O="clientHeight");function D(s,n,i,a){var f=Ce(o,n,i,a);Object.keys(f).forEach(function(u){s.style[u]=f[u]})}function Dt(s,n,i){var a=Mt(o,n,i);Object.keys(a).forEach(function(f){s.style[f]=a[f]})}function H(){return d.map(function(s){return s.size})}function xe(s){return"touches"in s?s.touches[0][g]:s[g]}function Re(s){var n=d[this.a],i=d[this.b],a=n.size+i.size;n.size=s/this.size*a,i.size=a-s/this.size*a,D(n.element,n.size,this[y],n.i),D(i.element,i.size,this[I],i.i)}function Nt(s){var n,i=d[this.a],a=d[this.b];!this.dragging||(n=xe(s)-this.start+(this[y]-this.dragOffset),le>1&&(n=Math.round(n/le)*le),n<=i.minSize+i.snapOffset+this[y]?n=i.minSize+this[y]:n>=this.size-(a.minSize+a.snapOffset+this[I])&&(n=this.size-(a.minSize+this[I])),n>=i.maxSize-i.snapOffset+this[y]?n=i.maxSize+this[y]:n<=this.size-(a.maxSize-a.snapOffset+this[I])&&(n=this.size-(a.maxSize+this[I])),Re.call(this,n),m(e,"onDrag",T)(H()))}function Ae(){var s=d[this.a].element,n=d[this.b].element,i=s[Oe](),a=n[Oe]();this.size=i[o]+a[o]+this[y]+this[I],this.start=i[l],this.end=i[E]}function Gt(s){if(!getComputedStyle)return null;var n=getComputedStyle(s);if(!n)return null;var i=s[O];return i===0?null:(A===X?i-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight):i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom),i)}function _e(s){var n=Gt(L);if(n===null||ae.reduce(function(u,S){return u+S},0)>n)return s;var i=0,a=[],f=s.map(function(u,S){var x=n*u/100,k=Z(M,S===0,S===s.length-1,W),K=ae[S]+k;return x<K?(i+=K-x,a.push(0),K):(a.push(x-K),x)});return i===0?s:f.map(function(u,S){var x=u;if(i>0&&a[S]-i>0){var k=Math.min(i,a[S]-i);i-=k,x=u-k}return x/n*100})}function bt(){var s=this,n=d[s.a].element,i=d[s.b].element;s.dragging&&m(e,"onDragEnd",T)(H()),s.dragging=!1,v[w]("mouseup",s.stop),v[w]("touchend",s.stop),v[w]("touchcancel",s.stop),v[w]("mousemove",s.move),v[w]("touchmove",s.move),s.stop=null,s.move=null,n[w]("selectstart",T),n[w]("dragstart",T),i[w]("selectstart",T),i[w]("dragstart",T),n.style.userSelect="",n.style.webkitUserSelect="",n.style.MozUserSelect="",n.style.pointerEvents="",i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",F.body.style.cursor=""}function zt(s){if(!("button"in s&&s.button!==0)){var n=this,i=d[n.a].element,a=d[n.b].element;n.dragging||m(e,"onDragStart",T)(H()),s.preventDefault(),n.dragging=!0,n.move=Nt.bind(n),n.stop=bt.bind(n),v[h]("mouseup",n.stop),v[h]("touchend",n.stop),v[h]("touchcancel",n.stop),v[h]("mousemove",n.move),v[h]("touchmove",n.move),i[h]("selectstart",T),i[h]("dragstart",T),a[h]("selectstart",T),a[h]("dragstart",T),i.style.userSelect="none",i.style.webkitUserSelect="none",i.style.MozUserSelect="none",i.style.pointerEvents="none",a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.MozUserSelect="none",a.style.pointerEvents="none",n.gutter.style.cursor=de,n.parent.style.cursor=de,F.body.style.cursor=de,Ae.call(n),n.dragOffset=xe(s)-n.end}}ie=_e(ie);var C=[];d=r.map(function(s,n){var i={element:ut(s),size:ie[n],minSize:ae[n],maxSize:xt[n],snapOffset:At[n],i:n},a;if(n>0&&(a={a:n-1,b:n,dragging:!1,direction:A,parent:L},a[y]=Z(M,n-1===0,!1,W),a[I]=Z(M,!1,n===r.length-1,W),V==="row-reverse"||V==="column-reverse")){var f=a.a;a.a=a.b,a.b=f}if(n>0){var u=_t(n,A,i.element);Dt(u,M,n),a[P]=zt.bind(a),u[h]("mousedown",a[P]),u[h]("touchstart",a[P]),L.insertBefore(u,i.element),a.gutter=u}return D(i.element,i.size,Z(M,n===0,n===r.length-1,W),n),n>0&&C.push(a),i});function Me(s){var n=s.i===C.length,i=n?C[s.i-1]:C[s.i];Ae.call(i);var a=n?i.size-s.minSize-i[I]:s.minSize+i[y];Re.call(i,a)}d.forEach(function(s){var n=s.element[Oe]()[o];n<s.minSize&&(Rt?Me(s):s.minSize=n)});function Pt(s){var n=_e(s);n.forEach(function(i,a){if(a>0){var f=C[a-1],u=d[f.a],S=d[f.b];u.size=n[a-1],S.size=i,D(u.element,u.size,f[y],u.i),D(S.element,S.size,f[I],S.i)}})}function Ft(s,n){C.forEach(function(i){if(n!==!0?i.parent.removeChild(i.gutter):(i.gutter[w]("mousedown",i[P]),i.gutter[w]("touchstart",i[P])),s!==!0){var a=Ce(o,i.a.size,i[y]);Object.keys(a).forEach(function(f){d[i.a].element.style[f]="",d[i.b].element.style[f]=""})}})}return{setSizes:Pt,getSizes:H,collapse:function(n){Me(d[n])},destroy:Ft,parent:L,pairs:C}},mt=Yt;var $t=`
<div class="circle-loader">
  <svg class="circular" viewBox="25 25 50 50">
  <circle
    class="path"
    cx="50"
    cy="50"
    r="20"
    fill="none"
    stroke-width="2"
    stroke-miterlimit="10"
  />
  </svg>
</div>
`;function St(){let t=document.createElement("div");t.className="strigo-loader",t.innerHTML=$t,document.body.appendChild(t)}function pt(){let t=document.querySelector(".strigo-loader");return new Promise(e=>{let r=setInterval(()=>{t.style.opacity||(t.style.opacity="1");let o=parseFloat(t.style.opacity);o>0?t.style.opacity=(o-.1).toString():(t.style.pointerEvents="none",clearInterval(r),e())},200)})}function Le(){let t=ye();if(t){c.info("Posting event",t),window.frames[0].postMessage(t,"*");let e=Qe();t.eventName!==e.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:t,poppedEvent:e})}}function vt(){for(;ye();)Le()}function jt(){document.getElementById("strigo-widget").classList.add("slide-in"),document.getElementById("strigo-widget").classList.add("loaded")}var ht=class{init(){c.info("overlay init called");let e=p();return e&&window.Strigo.setup(e),"OVERLAY"}setup({development:e,version:r}){c.info("overlay setup called"),q({parentElement:j(),url:He(e,r)});let o=gt(U(p()));this.initEventListeners(o)}shutdown(){c.info("overlay shutdown called"),ct(),he()}open(){lt()}initEventListeners(e){re(e,jt),te(),window.addEventListener("overlay-widget-event",r=>{ee(r?.detail)})}},Q=new ht;function ee({key:t,oldValue:e,newValue:r}){if(t!=="strigoEvents")return;let o=JSON.parse(r)?.events,g=JSON.parse(e)?.events;o.filter(({eventName:E})=>!g.some(({eventName:O})=>E===O)).length>0&&Le()}function te(){window.addEventListener("message",t=>{if(!(!t||!t.data))switch(t.data){case"close":{window.Strigo?.shutdown();break}case"challenge-success":{c.info("Challenge event success received"),R()==="overlay"&&Q.open();break}default:break}},!1)}function re(t,e){t.addEventListener("load",async()=>{je("isLoading")&&(e&&await e(),Ee("isLoading",!1)),vt()})}function yt(t){let e=Be("initSite")?.host;t.addEventListener("load",function(){try{this.contentWindow.location.host!==e&&window.Strigo.shutdown()}catch(r){c.error(r),window.Strigo.shutdown()}})}var Tt=class{init(){let e;if($())c.info("Child SDK window"),e="CHILD",window.dispatchEvent(new Event("strigo-opened"));else{c.info("Parent SDK window"),e="PARENT";let r=p();r&&window.Strigo.setup(r)}return e}setup({development:e,version:r}){c.info("iframe setup started"),tt(),q({parentElement:j(),url:We(e,r)}),St();let o=rt(),g=Te({parentElement:o,url:U(p()),classNames:be,id:"strigo-exercises"}),l=Te({parentElement:o,url:p().initSite.href,classNames:ze,id:"original-site"});mt(["#strigo-exercises","#original-site"],{sizes:[25,75],maxSize:it(),minSize:st(),gutterSize:2}),this.initEventListeners(g,l)}shutdown(){c.info("iframe shutdown called"),nt()}initEventListeners(e,r){re(e,pt),yt(r),te(),window.addEventListener("storage",ee)}},Ot=new Tt;function It(t){return t&&t==="dynamic"?at()?"iframe":"overlay":t}function ne(t){let e=null;switch(t){case"iframe":{e=Ot;break}case"overlay":{e=Q;break}default:throw c.error("Widget flavor is not supported",{widgetFlavor:t}),new Error(`Widget flavor ${t} is not supported`)}return e}var Lt=class{constructor(){this.initialized=!1;this.sdkType=void 0}init(){try{if(c.info("Initializing SDK..."),Xe(),this.initialized)return;this.initialized=!0;let e=ne(R());this.sdkType=e.init(),c.info("Initialized SDK.")}catch(e){c.error("Could not initialize SDK",{err:e})}}async setup(e){try{c.info("Starting to setup SDK...");let{email:r,token:o,development:g=!1,version:l}=e;if(!o)throw new Error("Token is not defined");let E=await $e(o,g);if(E){let{loggingConfig:V}=E;c.debug("Configuration fetched from Strigo"),c.setup(V)}if(this.sdkType==="CHILD"||this.sdkType==="OVERLAY"&&$()){c.info("panel is already opened");return}let{webApiKey:O,subDomain:d,selectedWidgetFlavor:_}=Ve();if(!g&&(!r||!o||!O||!d||!_))throw new Error("Setup data is missing");Ue({email:r,initSite:Fe(),token:o,webApiKey:O,subDomain:d,development:g,version:l,selectedWidgetFlavor:_,loggingConfig:E?.loggingConfig});let L=It(_);Je({currentUrl:p().initSite.href,isPanelOpen:!0,isLoading:!0,widgetFlavor:L}),ne(L).setup({version:l,development:g}),c.info("Finished SDK setup.")}catch(r){c.error("Could not setup SDK",{err:r})}}shutdown(){try{if(c.info("Shutting down SDK..."),this.sdkType==="CHILD"){window.parent.postMessage("close","*");return}let e=ne(R());Ye(),qe(),e.shutdown(),c.info("Finished SDK shutdown.")}catch(e){c.error("Could not shutdown SDK",{err:e})}}sendEvent(e){Ze({eventName:e}),c.debug("sendEvent called",{eventName:e})}},Ct=new Lt;window.Strigo=Ct;window.Strigo.init();})();
