(()=>{var z=Object.defineProperty;var Q=(e,t)=>{for(var o in t)z(e,o,{get:t[o],enumerable:!0})};function x(){return document.getElementsByTagName("head")[0]}function d(){return document.getElementsByTagName("body")[0]}function N(){document.open(),document.close()}function h(e){let{url:t,parentElement:o}=e,n=document.createElement("link");n.rel="stylesheet",n.href=t,o.appendChild(n)}function T(e){let{url:t,parentElement:o,classNames:n}=e,r=document.createElement("iframe");r.classList.add(...n),r.src=t,o.appendChild(r)}function L(){location.reload()}var y="strigo.io",M="localhost:3000",P="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk/dist/production/styles/strigo.min.css",D=["strigo-exercises"],B=["orig-iframe"];function Z(e){let t={};for(let[o,n]of e)t[o]=n;return t}function V(){let{host:e,pathname:t,href:o,origin:n,search:r}=window.location;return{host:e,pathName:t,href:o,origin:n,search:r,params:ee(r)}}function ee(e){let o=new URLSearchParams(e).entries();return Z(o)}function U(e){let{subDomain:t,token:o,webApiKey:n,development:r}=e;return r?`http://${M}/libro/courses?token=${o.token}&webApiKey=${n}`:`https://${t}.${y}/libro/courses?token=${o.token}&webApiKey=${n}`}function a(e,t){try{return JSON.parse(window[e].getItem(t))}catch(o){return console.log(o),null}}function f(e,t,o){try{return window[e].setItem(t,JSON.stringify(o)),o}catch(n){return console.log(n),null}}function I(e,t,o,n){try{let r=a(e,t);if(!r)throw new Error("Can't find initial state");let O={...r,[o]:n};return window[e].setItem(t,JSON.stringify(O)),O}catch(r){return console.log(r),null}}function S(e,t){try{window[e].removeItem(t)}catch(o){console.log(o)}}function k(){return a("localStorage","strigoConfig")}function K(e){return f("localStorage","strigoConfig",e)}function m(){return a("localStorage","strigoConfig")}function J(){S("localStorage","strigoConfig")}var G={};Q(G,{clearSession:()=>_,getSession:()=>H,init:()=>R,isPanelOpen:()=>C,setSessionValue:()=>ne,setup:()=>v});function R(){let e=a("sessionStorage","strigoSession");return e}function v(e){return f("sessionStorage","strigoSession",e)}function C(){return H()?.isPanelOpen}function H(){return a("sessionStorage","strigoSession")}function ne(e,t){return I("sessionStorage","strigoSession",e,t)}function _(){S("sessionStorage","strigoSession")}window.onunload=function(){S("sessionStorage","strigoSession")};function $(){try{let e=E();if(e)return console.log("Events storage already exists"),e;let t={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),t}catch(e){return console.log("Init events storage error",{error:e}),null}}function E(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(e){return console.log("Get events storage error",{error:e}),null}}function Y(e){try{let t=E();if(!t)throw new Error("Can't find initial state");return t.events.push(e),window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),t}catch(t){return console.log("Push event to storage error",{error:t}),null}}function W(){try{let e=E();if(!e)throw new Error("Can't find events storage");let t=e.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),t}catch(e){return console.log("Pop event from storage error",{error:e}),null}}function A(){try{let e=E();if(!e)throw new Error("Can't find events storage");return e.events.pop()}catch(e){return console.log("Get event from storage error",{error:e}),null}}var w;(g=>{function t(){let s=A();if(s){console.log("Posting event",s),window.frames[0].postMessage(s,"*");let i=W();s.eventName!==i.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:s,poppedEvent:i})}}function o(){for(;A();)t()}function n({key:s,oldValue:i,newValue:c}){let l=JSON.parse(c)?.events,p=JSON.parse(i)?.events;l.filter(({eventName:j})=>!p.some(({eventName:q})=>j===q)).length>0&&t()}function r(){k(),R(),$(),G&&C()?g.SDKType="SUBSCRIBER":g.SDKType="HOST",console.log("init called")}g.init=r;function O(s){if(g.SDKType==="SUBSCRIBER")return;console.log("setup started");let{email:i,token:c,webApiKey:l,subDomain:p,development:u=!1}=s;if(!u&&(!i||!c||!l||!p)){console.log("Please provide setup data");return}K({email:i,initSite:V(),token:c,webApiKey:l,subDomain:p,development:u}),N(),h({parentElement:x(),url:u?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:P}),T({parentElement:d(),url:U(m()),classNames:D}),T({parentElement:d(),url:m().initSite.href,classNames:B}),v({currentUrl:m().initSite.href,isPanelOpen:!0}),o(),window.addEventListener("storage",n),console.log("setup finished")}g.setup=O;function se(){g.SDKType==="SUBSCRIBER"&&(J(),_(),L()),console.log("shutdown called")}g.shutdown=se;function ie(s){Y({eventName:s}),console.log("sendEvent called",{eventName:s})}g.sendEvent=ie})(w||={});window.StrigoSDK=w;window.StrigoSDK.init();})();
