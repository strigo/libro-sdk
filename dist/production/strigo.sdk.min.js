(()=>{var De="strigo-sdk",Me="strigo.io",Ge="localhost:3000",Ne=["strigo-exercises"],ze=["orig-iframe"],ge=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"/></svg>
`,be=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"/></svg>
`,M="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk";var ce="strigoChildIframe";function Ut(t){let e={};for(let[r,n]of t)e[r]=n;return e}function Kt(t){let r=new URLSearchParams(t).entries();return Ut(r)}function Pe(){let{host:t,pathname:e,href:r,origin:n,search:a}=window.location;return{host:t,pathName:e,href:r,origin:n,search:a,params:Kt(a)}}function H(t){let{subDomain:e,user:r,webApiKey:n,development:a}=t;return a?`http://${Ge}/academy/courses?token=${r.token.token}&webApiKey=${n}`:`https://${e}.${Me}/academy/courses?token=${r.token.token}&webApiKey=${n}`}function Fe(t){let e=new URL(t);return e.searchParams.set(ce,"true"),e.toString()}function We(){return window.location.search.includes(ce)}function Ve(){let t=new URL(window.location.href),e=new URLSearchParams(t.search);e.delete(ce),t.search=e.toString(),window.history.replaceState(window.history.state,"",t)}function ke(){let t=document.getElementById(De);return{webApiKey:t?.getAttribute("data-web-api-key")||"",subDomain:t?.getAttribute("data-subdomain")||"",selectedWidgetFlavor:t?.getAttribute("data-layout-flavor")||"dynamic"}}function He(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:e?`${M}@${e}/dist/production/styles/strigo.min.css`:`${M}@master/dist/production/styles/strigo.min.css`}function Ue(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo-widget.css`:e?`${M}@${e}/dist/production/styles/strigo-widget.min.css`:`${M}@master/dist/production/styles/strigo-widget.min.css`}var Ke=class{constructor(e){this.url=e?.url}setup(e){this.url=e.url}logToRemote(e,r,n){return fetch(this.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:r,context:n})}).then(a=>{a.ok||console.warn("Logging to Strigo failed",{result:a})}).catch(a=>{console.warn("Logging to Strigo failed",{err:a})})}logToConsole(e,r,n){let a=`${new Date().toISOString()} - ${r}`;console[e](a,n?`
${JSON.stringify(n)}`:"")}getDefaultContext(){let e=p();if(!e)return{};let{user:r,subDomain:n,initSite:a,development:c,version:E,selectedWidgetFlavor:O}=e;return{token:r?.token.token,initSite:a?.href,subDomain:n,development:c,version:E,selectedWidgetFlavor:O}}log(e,r,n){let a={...this.getDefaultContext(),...n};try{this.url&&!p()?.development&&this.logToRemote(e,r,a),this.logToConsole(e,`Academy - ${r}`,a)}catch(c){console.log("Logging error:",{err:c})}}debug(e,r={}){this.log("debug",e,r)}info(e,r={}){this.log("info",e,r)}warn(e,r={}){this.log("warn",e,r)}error(e,r={}){this.log("error",e,r)}},l=new Ke;function N(t,e){try{return JSON.parse(window[t].getItem(e))}catch(r){return l.error("get storage data error",{err:r}),null}}function z(t,e,r){try{return window[t].setItem(e,JSON.stringify(r)),r}catch(n){return l.error("setup storage error",{err:n}),null}}function ue(t,e,r,n){try{let a=N(t,e);if(!a)throw new Error("Can't find initial state");let c={...a,[r]:n};return window[t].setItem(e,JSON.stringify(c)),c}catch(a){return l.error("set storage value error",{err:a}),null}}function fe(t,e){try{window[t].removeItem(e)}catch(r){l.error("clear storage error",{err:r})}}function p(){return N("localStorage","strigoConfig")}function Ye(t){let e=p();return z("localStorage","strigoConfig",{...t,...e})}function $e(t){let e=p();return z("localStorage","strigoConfig",{...e,...t})}function Je(t){return p()?.[t]}async function je(t,e){try{let n=await fetch(`${e?"http://localhost:3000":"https://app.strigo.io"}/api/internal/academy/v1/config`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}});if(!n.ok)throw new Error(`Failed to fetch remote configuration: ${n.statusText}`);return(await n.json()).data}catch(r){return l.warn("Error fetching configuration from Strigo",{err:r}),null}}function qe(t){return z("sessionStorage","strigoSession",t)}function Se(){return N("sessionStorage","strigoSession")}function Xe(){return Se()?.isPanelOpen}function x(){return Se()?.widgetFlavor}function pe(t,e){return ue("sessionStorage","strigoSession",t,e)}function Ze(t){return Se()?.[t]}function Qe(){fe("sessionStorage","strigoSession")}function et(){pe("isPanelOpen",!1)}function K(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(t){return l.error("Get events storage error",{error:t}),null}}function tt(){try{let t=K();if(t)return l.debug("Events storage already exists"),t;let e={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),e}catch(t){return l.error("Init events storage error",{error:t}),null}}function rt(t){try{let e=K();if(!e)throw new Error("Can't find initial state");let r=JSON.stringify(e);if(e.events.push(t),window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),x()==="overlay"){let n=new CustomEvent("overlay-widget-event",{bubbles:!0,detail:{key:"strigoEvents",oldValue:r,newValue:JSON.stringify(e)}});window.dispatchEvent(n)}return e}catch(e){return l.error("Push event to storage error",{error:e}),null}}function ot(){try{let t=K();if(!t)throw new Error("Can't find events storage");let e=t.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),e}catch(t){return l.error("Pop event from storage error",{error:t}),null}}function Ee(){try{let t=K();if(!t)throw new Error("Can't find events storage");return t.events.pop()}catch(t){return l.error("Get event from storage error",{error:t}),null}}function B(){return document.getElementsByTagName("head")[0]}function it(){document.open(),document.close()}function st(){let t=document.createElement("div");return t.className="strigo-main",document.body.appendChild(t),t}function Y(t){let{url:e,parentElement:r}=t,n=document.createElement("link");n.rel="stylesheet",n.href=e,r.appendChild(n)}function he(t){let{url:e,parentElement:r,classNames:n,id:a}=t,c=document.createElement("iframe");return c.classList.add(...n),c.id=a,c.src=e,r.appendChild(c),c}function at(){location.reload()}function gt(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function lt(){return gt()?[window.screen.width,window.screen.width]:[window.screen.width/2,window.screen.width]}function ct(){return gt()?[0,0]:[window.screen.width*.25,0]}function dt(){let t=new XMLHttpRequest;t.open("GET",window.document.location.href,!1),t.send(null);let r=t.getAllResponseHeaders().toLowerCase().split(`\r
`);for(let n of r)if(n.includes("x-frame-options")){let a=n.split(":");if(a&&a.length>1)return a[1].trim()!=="deny"}return!0}function Bt(){let t=document.getElementById("strigo-widget"),e=t.classList.contains("slide-in");t.classList.toggle("slide-in"),setTimeout(()=>{let r=document.getElementById("strigo-arrow");r.innerHTML=e?be:ge},300)}function ut(t){let e=document.createElement("div");e.className="strigo-arrow",e.id="strigo-arrow",e.innerHTML=ge;let r=document.createElement("div");r.className="strigo-collapse-button",r.id="strigo-toggle",r.appendChild(e);let n=document.createElement("div");n.className="strigo-collapse-div",n.onclick=()=>{Bt()},n.appendChild(r);let a=document.createElement("iframe");a.className="strigo-iframe",a.id="strigo-exercises",a.src=t;let c=document.createElement("div");return c.id="strigo-widget",c.appendChild(n),c.appendChild(a),document.body.appendChild(c),a}function ft(){document.getElementById("strigo-widget").remove()}function mt(){let t=document.getElementById("strigo-widget");t.classList.contains("slide-in")||t.classList.add("slide-in")}var v=typeof window!="undefined"?window:null,ye=v===null,P=ye?void 0:v.document,h="addEventListener",w="removeEventListener",we="getBoundingClientRect",b="_a",y="_b",I="_c",$="horizontal",T=function(){return!1},Yt=ye?"calc":["","-webkit-","-moz-","-o-"].filter(function(t){var e=P.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",vt=function(t){return typeof t=="string"||t instanceof String},pt=function(t){if(vt(t)){var e=P.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},m=function(t,e,r){var n=t[e];return n!==void 0?n:r},J=function(t,e,r,n){if(e){if(n==="end")return 0;if(n==="center")return t/2}else if(r){if(n==="start")return 0;if(n==="center")return t/2}return t},$t=function(t,e){var r=P.createElement("div");return r.className="gutter gutter-"+e,r},Jt=function(t,e,r){var n={};return vt(e)?n[t]=e:n[t]=Yt+"("+e+"% - "+r+"px)",n},jt=function(t,e){var r;return r={},r[t]=e+"px",r},qt=function(t,e){if(e===void 0&&(e={}),ye)return{};var r=t,n,a,c,E,O,d;Array.from&&(r=Array.from(r));var ee=pt(r[0]),A=ee.parentNode,Oe=getComputedStyle?getComputedStyle(A):null,Ie=Oe?Oe.flexDirection:null,te=m(e,"sizes")||r.map(function(){return 100/r.length}),re=m(e,"minSize",100),oe=Array.isArray(re)?re:r.map(function(){return re}),ne=m(e,"maxSize",1/0),Dt=Array.isArray(ne)?ne:r.map(function(){return ne}),Mt=m(e,"expandToMin",!1),_=m(e,"gutterSize",10),F=m(e,"gutterAlign","center"),ie=m(e,"snapOffset",30),Gt=Array.isArray(ie)?ie:r.map(function(){return ie}),se=m(e,"dragInterval",1),R=m(e,"direction",$),ae=m(e,"cursor",R===$?"col-resize":"row-resize"),Nt=m(e,"gutter",$t),Le=m(e,"elementStyle",Jt),zt=m(e,"gutterStyle",jt);R===$?(n="width",a="clientX",c="left",E="right",O="clientWidth"):R==="vertical"&&(n="height",a="clientY",c="top",E="bottom",O="clientHeight");function D(s,o,i,g){var f=Le(n,o,i,g);Object.keys(f).forEach(function(u){s.style[u]=f[u]})}function bt(s,o,i){var g=zt(n,o,i);Object.keys(g).forEach(function(f){s.style[f]=g[f]})}function W(){return d.map(function(s){return s.size})}function Ce(s){return"touches"in s?s.touches[0][a]:s[a]}function Re(s){var o=d[this.a],i=d[this.b],g=o.size+i.size;o.size=s/this.size*g,i.size=g-s/this.size*g,D(o.element,o.size,this[y],o.i),D(i.element,i.size,this[I],i.i)}function Pt(s){var o,i=d[this.a],g=d[this.b];!this.dragging||(o=Ce(s)-this.start+(this[y]-this.dragOffset),se>1&&(o=Math.round(o/se)*se),o<=i.minSize+i.snapOffset+this[y]?o=i.minSize+this[y]:o>=this.size-(g.minSize+g.snapOffset+this[I])&&(o=this.size-(g.minSize+this[I])),o>=i.maxSize-i.snapOffset+this[y]?o=i.maxSize+this[y]:o<=this.size-(g.maxSize-g.snapOffset+this[I])&&(o=this.size-(g.maxSize+this[I])),Re.call(this,o),m(e,"onDrag",T)(W()))}function xe(){var s=d[this.a].element,o=d[this.b].element,i=s[we](),g=o[we]();this.size=i[n]+g[n]+this[y]+this[I],this.start=i[c],this.end=i[E]}function Ft(s){if(!getComputedStyle)return null;var o=getComputedStyle(s);if(!o)return null;var i=s[O];return i===0?null:(R===$?i-=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight):i-=parseFloat(o.paddingTop)+parseFloat(o.paddingBottom),i)}function Ae(s){var o=Ft(A);if(o===null||oe.reduce(function(u,S){return u+S},0)>o)return s;var i=0,g=[],f=s.map(function(u,S){var C=o*u/100,V=J(_,S===0,S===s.length-1,F),k=oe[S]+V;return C<k?(i+=k-C,g.push(0),k):(g.push(C-k),C)});return i===0?s:f.map(function(u,S){var C=u;if(i>0&&g[S]-i>0){var V=Math.min(i,g[S]-i);i-=V,C=u-V}return C/o*100})}function Wt(){var s=this,o=d[s.a].element,i=d[s.b].element;s.dragging&&m(e,"onDragEnd",T)(W()),s.dragging=!1,v[w]("mouseup",s.stop),v[w]("touchend",s.stop),v[w]("touchcancel",s.stop),v[w]("mousemove",s.move),v[w]("touchmove",s.move),s.stop=null,s.move=null,o[w]("selectstart",T),o[w]("dragstart",T),i[w]("selectstart",T),i[w]("dragstart",T),o.style.userSelect="",o.style.webkitUserSelect="",o.style.MozUserSelect="",o.style.pointerEvents="",i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",P.body.style.cursor=""}function Vt(s){if(!("button"in s&&s.button!==0)){var o=this,i=d[o.a].element,g=d[o.b].element;o.dragging||m(e,"onDragStart",T)(W()),s.preventDefault(),o.dragging=!0,o.move=Pt.bind(o),o.stop=Wt.bind(o),v[h]("mouseup",o.stop),v[h]("touchend",o.stop),v[h]("touchcancel",o.stop),v[h]("mousemove",o.move),v[h]("touchmove",o.move),i[h]("selectstart",T),i[h]("dragstart",T),g[h]("selectstart",T),g[h]("dragstart",T),i.style.userSelect="none",i.style.webkitUserSelect="none",i.style.MozUserSelect="none",i.style.pointerEvents="none",g.style.userSelect="none",g.style.webkitUserSelect="none",g.style.MozUserSelect="none",g.style.pointerEvents="none",o.gutter.style.cursor=ae,o.parent.style.cursor=ae,P.body.style.cursor=ae,xe.call(o),o.dragOffset=Ce(s)-o.end}}te=Ae(te);var L=[];d=r.map(function(s,o){var i={element:pt(s),size:te[o],minSize:oe[o],maxSize:Dt[o],snapOffset:Gt[o],i:o},g;if(o>0&&(g={a:o-1,b:o,dragging:!1,direction:R,parent:A},g[y]=J(_,o-1===0,!1,F),g[I]=J(_,!1,o===r.length-1,F),Ie==="row-reverse"||Ie==="column-reverse")){var f=g.a;g.a=g.b,g.b=f}if(o>0){var u=Nt(o,R,i.element);bt(u,_,o),g[b]=Vt.bind(g),u[h]("mousedown",g[b]),u[h]("touchstart",g[b]),A.insertBefore(u,i.element),g.gutter=u}return D(i.element,i.size,J(_,o===0,o===r.length-1,F),o),o>0&&L.push(g),i});function _e(s){var o=s.i===L.length,i=o?L[s.i-1]:L[s.i];xe.call(i);var g=o?i.size-s.minSize-i[I]:s.minSize+i[y];Re.call(i,g)}d.forEach(function(s){var o=s.element[we]()[n];o<s.minSize&&(Mt?_e(s):s.minSize=o)});function kt(s){var o=Ae(s);o.forEach(function(i,g){if(g>0){var f=L[g-1],u=d[f.a],S=d[f.b];u.size=o[g-1],S.size=i,D(u.element,u.size,f[y],u.i),D(S.element,S.size,f[I],S.i)}})}function Ht(s,o){L.forEach(function(i){if(o!==!0?i.parent.removeChild(i.gutter):(i.gutter[w]("mousedown",i[b]),i.gutter[w]("touchstart",i[b])),s!==!0){var g=Le(n,i.a.size,i[y]);Object.keys(g).forEach(function(f){d[i.a].element.style[f]="",d[i.b].element.style[f]=""})}})}return{setSizes:kt,getSizes:W,collapse:function(o){_e(d[o])},destroy:Ht,parent:A,pairs:L}},Et=qt;var Xt=`
<div class="circle-loader">
  <svg class="circular" viewBox="25 25 50 50">
  <circle
    class="path"
    cx="50"
    cy="50"
    r="20"
    fill="none"
    stroke-width="2"
    stroke-miterlimit="10"
  />
  </svg>
</div>
`;function ht(){let t=document.createElement("div");t.className="strigo-loader",t.innerHTML=Xt,document.body.appendChild(t)}function wt(){let t=document.querySelector(".strigo-loader");return new Promise(e=>{let r=setInterval(()=>{t.style.opacity||(t.style.opacity="1");let n=parseFloat(t.style.opacity);n>0?t.style.opacity=(n-.1).toString():(t.style.pointerEvents="none",clearInterval(r),e())},200)})}function Te(){let t=Ee();if(t){l.info("Posting event",t),window.frames[0].postMessage(t,"*");let e=ot();t.eventName!==e.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:t,poppedEvent:e})}}function yt(){for(;Ee();)Te()}function Qt(){document.getElementById("strigo-widget").classList.add("slide-in"),document.getElementById("strigo-widget").classList.add("loaded")}var Ot=class{init(){return l.info("overlay init called"),"OVERLAY"}setup({development:e,version:r}){l.info("overlay setup called"),Y({parentElement:B(),url:Ue(e,r)});let n=ut(H(p()));this.initEventListeners(n)}shutdown(){l.info("overlay shutdown called"),ft(),et()}open(){mt()}initEventListeners(e){Z(e,Qt),X(),window.addEventListener("overlay-widget-event",r=>{q(r?.detail)})}},j=new Ot;function q({key:t,oldValue:e,newValue:r}){if(t!=="strigoEvents")return;let n=JSON.parse(r)?.events,a=JSON.parse(e)?.events;n.filter(({eventName:E})=>!a.some(({eventName:O})=>E===O)).length>0&&Te()}function X(){window.addEventListener("message",t=>{if(!(!t||!t.data))switch(t.data){case"close":{window.Strigo?.shutdown();break}case"challenge-success":{l.info("Challenge event success received"),x()==="overlay"&&j.open();break}default:break}},!1)}function Z(t,e){t.addEventListener("load",async()=>{Ze("isLoading")&&(e&&await e(),pe("isLoading",!1)),yt()})}function Lt(t){let e=Je("initSite")?.host;t.addEventListener("load",function(){try{this.contentWindow.location.host!==e&&window.Strigo.shutdown()}catch(r){l.error(r),window.Strigo.shutdown()}})}var Ct=class{init(){let e;return We()?(l.info("Child SDK window"),e="CHILD",window.dispatchEvent(new Event("strigo-opened")),Ve()):(l.info("Parent SDK window"),e="PARENT"),e}setup({development:e,version:r}){l.info("iframe setup started"),it(),Y({parentElement:B(),url:He(e,r)}),ht();let n=p(),a=st(),c=he({parentElement:a,url:H(n),classNames:Ne,id:"strigo-exercises"}),E=he({parentElement:a,url:Fe(n.initSite.href),classNames:ze,id:"original-site"});Et(["#strigo-exercises","#original-site"],{sizes:[25,75],maxSize:lt(),minSize:ct(),gutterSize:2}),this.initEventListeners(c,E)}shutdown(){l.info("iframe shutdown called"),at()}initEventListeners(e,r){Z(e,wt),Lt(r),X(),window.addEventListener("storage",q)}},Rt=new Ct;function xt(t){return t&&t==="dynamic"?dt()?"iframe":"overlay":t}function Q(t){let e=null;switch(t){case"iframe":{e=Rt;break}case"overlay":{e=j;break}default:throw l.error("Widget flavor is not supported",{widgetFlavor:t}),new Error(`Widget flavor ${t} is not supported`)}return e}var At=class{constructor(){this.initialized=!1;this.configured=!1;this.isOpen=!1;this.sdkType=void 0}init(){try{if(l.info("Initializing SDK..."),this.initialized){l.info("SDK was already initialized");return}tt();let{webApiKey:e,subDomain:r,selectedWidgetFlavor:n}=ke();if(!e||!r||!n)throw new Error("Init data is missing");let a=xt(n);Ye({webApiKey:e,subDomain:r,selectedWidgetFlavor:a});let c=Q(a);this.sdkType=c.init(),this.initialized=!0,l.info("Initialized SDK."),this.sdkType!=="CHILD"&&Xe()&&this.setup()}catch(e){l.error("Could not initialize SDK",{err:e})}}async setup(e){try{if(l.info("Starting to setup SDK..."),this.isOpen||this.sdkType==="CHILD"){l.info("panel is already opened");return}if(!this.initialized)throw new Error("SDK was not initialized");let r=p(),{email:n,token:a,development:c=!1,version:E,openWidget:O=!0}={...r.user,...r,...e};if(!c&&(!n||!a))throw new Error("Setup data is missing");let d=await je(a,c);if(d){let{loggingConfig:ee}=d;l.debug("Configuration fetched from Strigo"),l.setup(ee)}$e({user:{email:n,token:a},initSite:Pe(),development:c,version:E,loggingConfig:d?.loggingConfig}),this.configured=!0,l.info("Finished SDK setup."),O&&this.open()}catch(r){l.error("Could not setup SDK",{err:r})}}open(){try{if(!this.configured)throw new Error("SDK was not set up");if(this.isOpen||this.sdkType==="CHILD"){l.info("Panel is already opened");return}let e=p();qe({currentUrl:e.initSite.href,isPanelOpen:!0,isLoading:!0,widgetFlavor:e.selectedWidgetFlavor}),Q(e.selectedWidgetFlavor).setup({version:e.version,development:e.development}),this.isOpen=!0}catch(e){l.error("Could not open Strigo widget",{err:e})}}shutdown(){try{if(l.info("Shutting down SDK..."),this.sdkType==="CHILD"){window.parent.postMessage("close","*");return}let e=Q(x());Qe(),e.shutdown(),this.isOpen=!1,l.info("Finished SDK shutdown.")}catch(e){l.error("Could not shutdown SDK",{err:e})}}sendEvent(e){rt({eventName:e}),l.debug("sendEvent called",{eventName:e})}},_t=new At;window.Strigo=_t;window.Strigo.init();})();
