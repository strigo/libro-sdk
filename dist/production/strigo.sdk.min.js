(()=>{var ze="strigo-sdk",Fe="strigo.io",De="localhost:3000",Pe=["strigo-exercises"],Ve=["orig-iframe"],pe=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"/></svg>
`,We=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"/></svg>
`,H="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk";function zt(e){let t={};for(let[n,s]of e)t[n]=s;return t}function ke(){let{host:e,pathname:t,href:n,origin:s,search:c}=window.location;return{host:e,pathName:t,href:n,origin:s,search:c,params:Ft(c)}}function Ft(e){let n=new URLSearchParams(e).entries();return zt(n)}function X(e){let{subDomain:t,token:n,webApiKey:s,development:c}=e;return c?`http://${De}/academy/courses?token=${n.token}&webApiKey=${s}`:`https://${t}.${Fe}/academy/courses?token=${n.token}&webApiKey=${s}`}function He(){let e=document.getElementById(ze);return{webApiKey:e?.getAttribute("data-web-api-key")||"",subDomain:e?.getAttribute("data-subdomain")||"",selectedWidgetFlavor:e?.getAttribute("data-layout-flavor")||"dynamic"}}function Be(e,t){return e?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:t?`${H}@${t}/dist/production/styles/strigo.min.css`:`${H}@master/dist/production/styles/strigo.min.css`}function Ue(e,t){return e?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo-widget.css`:t?`${H}@${t}/dist/production/styles/strigo-widget.min.css`:`${H}@master/dist/production/styles/strigo-widget.min.css`}var Ye=class{constructor(t){this.url=t?.url}setup(t){this.url=t.url}logToRemote(t,n,s){fetch(this.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:t,message:n,context:s})}).then(c=>{c.ok||console.warn("Logging to Strigo failed",{result:c})}).catch(c=>{console.warn("Logging to Strigo failed",{err:c})})}logToConsole(t,n,s){let c=`${new Date().toISOString()} - ${n}`;console[t](c,s?`
${JSON.stringify(s)}`:"")}getDefaultContext(){let t=h();if(!t)return{};let{token:n,subDomain:s,initSite:c,development:u,version:m,selectedWidgetFlavor:f}=t;return{token:n.token,initSite:c.href,subDomain:s,development:u,version:m,selectedWidgetFlavor:f}}log(t,n,s){let c={...this.getDefaultContext(),...s};try{this.url&&!h()?.development&&this.logToRemote(t,n,c),this.logToConsole(t,`Academy - ${n}`,c)}catch(u){console.log("Logging error:",{err:u})}}debug(t,n={}){this.log("debug",t,n)}info(t,n={}){this.log("info",t,n)}warn(t,n={}){this.log("warn",t,n)}error(t,n={}){this.log("error",t,n)}},g=new Ye;function B(e,t){try{return JSON.parse(window[e].getItem(t))}catch(n){return g.error("get storage data error",{err:n}),null}}function Q(e,t,n){try{return window[e].setItem(t,JSON.stringify(n)),n}catch(s){return g.error("setup storage error",{err:s}),null}}function he(e,t,n,s){try{let c=B(e,t);if(!c)throw new Error("Can't find initial state");let u={...c,[n]:s};return window[e].setItem(t,JSON.stringify(u)),u}catch(c){return g.error("set storage value error",{err:c}),null}}function ee(e,t){try{window[e].removeItem(t)}catch(n){g.error("clear storage error",{err:n})}}function Ke(e){return Q("localStorage","strigoConfig",e)}function h(){return B("localStorage","strigoConfig")}function Je(){ee("localStorage","strigoConfig")}function je(e){return Q("sessionStorage","strigoSession",e)}function te(){return ye()?.isPanelOpen}function I(){return ye()?.widgetFlavor}function ye(){return B("sessionStorage","strigoSession")}function M(e,t){return he("sessionStorage","strigoSession",e,t)}function qe(e){return ye()?.[e]}function Xe(){ee("sessionStorage","strigoSession")}function Oe(){M("isPanelOpen",!1)}window.onunload=function(){Oe()};function Ze(){try{let e=re();if(e)return g.debug("Events storage already exists"),e;let t={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),t}catch(e){return g.error("Init events storage error",{error:e}),null}}function re(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(e){return g.error("Get events storage error",{error:e}),null}}function Qe(e){try{let t=re();if(!t)throw new Error("Can't find initial state");let n=JSON.stringify(t);if(t.events.push(e),window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),I()==="overlay"){let s=new CustomEvent("overlay-widget-event",{bubbles:!0,detail:{key:"strigoEvents",oldValue:n,newValue:JSON.stringify(t)}});window.dispatchEvent(s)}return t}catch(t){return g.error("Push event to storage error",{error:t}),null}}function et(){try{let e=re();if(!e)throw new Error("Can't find events storage");let t=e.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),t}catch(e){return g.error("Pop event from storage error",{error:e}),null}}function Le(){try{let e=re();if(!e)throw new Error("Can't find events storage");return e.events.pop()}catch(e){return g.error("Get event from storage error",{error:e}),null}}function ne(){return document.getElementsByTagName("head")[0]}function rt(){document.open(),document.close()}function nt(){let e=document.createElement("div");return e.className="strigo-main",document.body.appendChild(e),e}function oe(e){let{url:t,parentElement:n}=e,s=document.createElement("link");s.rel="stylesheet",s.href=t,n.appendChild(s)}function Ce(e){let{url:t,parentElement:n,classNames:s,id:c}=e,u=document.createElement("iframe");return u.classList.add(...s),u.id=c,u.src=t,n.appendChild(u),u}function ot(){location.reload()}function it(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function st(){return it()?[window.screen.width,window.screen.width]:[window.screen.width/2,window.screen.width]}function at(){return it()?[0,0]:[window.screen.width*.25,0]}function gt(){let e=new XMLHttpRequest;e.open("GET",window.document.location.href,!1),e.send(null);let n=e.getAllResponseHeaders().toLowerCase().split(`\r
`);for(let s of n)if(s.includes("x-frame-options")){let c=s.split(":");if(c&&c.length>1)return c[1].trim()!=="deny"}return!0}function ct(e){let t=function(){let f=document.getElementById("strigo-widget"),l=f.classList.contains("slide-in");f.classList.toggle("slide-in"),setTimeout(()=>{let y=document.getElementById("strigo-arrow");y.innerHTML=l?We:pe},300)},n=document.createElement("div");n.className="strigo-arrow",n.id="strigo-arrow",n.innerHTML=pe;let s=document.createElement("div");s.className="strigo-collapse-button",s.id="strigo-toggle",s.appendChild(n);let c=document.createElement("div");c.className="strigo-collapse-div",c.onclick=()=>{t()},c.appendChild(s);let u=document.createElement("iframe");u.className="strigo-iframe",u.id="strigo-exercises",u.src=e;let m=document.createElement("div");return m.className="strigo-widget",m.id="strigo-widget",m.appendChild(c),m.appendChild(u),document.body.appendChild(m),u}var lt=function(){document.getElementById("strigo-widget").remove()},ut=function(){let e=document.getElementById("strigo-widget");e.classList.contains("slide-in")||e.classList.add("slide-in")};var w=typeof window!="undefined"?window:null,xe=w===null,Y=xe?void 0:w.document,O="addEventListener",T="removeEventListener",Ie="getBoundingClientRect",U="_a",L="_b",x="_c",ie="horizontal",C=function(){return!1},Dt=xe?"calc":["","-webkit-","-moz-","-o-"].filter(function(e){var t=Y.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length}).shift()+"calc",mt=function(e){return typeof e=="string"||e instanceof String},dt=function(e){if(mt(e)){var t=Y.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},p=function(e,t,n){var s=e[t];return s!==void 0?s:n},se=function(e,t,n,s){if(t){if(s==="end")return 0;if(s==="center")return e/2}else if(n){if(s==="start")return 0;if(s==="center")return e/2}return e},Pt=function(e,t){var n=Y.createElement("div");return n.className="gutter gutter-"+t,n},Vt=function(e,t,n){var s={};return mt(t)?s[e]=t:s[e]=Dt+"("+t+"% - "+n+"px)",s},Wt=function(e,t){var n;return n={},n[e]=t+"px",n},kt=function(e,t){if(t===void 0&&(t={}),xe)return{};var n=e,s,c,u,m,f,l;Array.from&&(n=Array.from(n));var y=dt(n[0]),v=y.parentNode,N=getComputedStyle?getComputedStyle(v):null,G=N?N.flexDirection:null,b=p(t,"sizes")||n.map(function(){return 100/n.length}),z=p(t,"minSize",100),A=Array.isArray(z)?z:n.map(function(){return z}),F=p(t,"maxSize",1/0),$=Array.isArray(F)?F:n.map(function(){return F}),fe=p(t,"expandToMin",!1),W=p(t,"gutterSize",10),K=p(t,"gutterAlign","center"),de=p(t,"snapOffset",30),Ct=Array.isArray(de)?de:n.map(function(){return de}),me=p(t,"dragInterval",1),D=p(t,"direction",ie),Se=p(t,"cursor",D===ie?"col-resize":"row-resize"),It=p(t,"gutter",Pt),Re=p(t,"elementStyle",Vt),xt=p(t,"gutterStyle",Wt);D===ie?(s="width",c="clientX",u="left",m="right",f="clientWidth"):D==="vertical"&&(s="height",c="clientY",u="top",m="bottom",f="clientHeight");function k(i,r,o,a){var S=Re(s,r,o,a);Object.keys(S).forEach(function(d){i.style[d]=S[d]})}function At(i,r,o){var a=xt(s,r,o);Object.keys(a).forEach(function(S){i.style[S]=a[S]})}function J(){return l.map(function(i){return i.size})}function _e(i){return"touches"in i?i.touches[0][c]:i[c]}function Me(i){var r=l[this.a],o=l[this.b],a=r.size+o.size;r.size=i/this.size*a,o.size=a-i/this.size*a,k(r.element,r.size,this[L],r.i),k(o.element,o.size,this[x],o.i)}function Rt(i){var r,o=l[this.a],a=l[this.b];!this.dragging||(r=_e(i)-this.start+(this[L]-this.dragOffset),me>1&&(r=Math.round(r/me)*me),r<=o.minSize+o.snapOffset+this[L]?r=o.minSize+this[L]:r>=this.size-(a.minSize+a.snapOffset+this[x])&&(r=this.size-(a.minSize+this[x])),r>=o.maxSize-o.snapOffset+this[L]?r=o.maxSize+this[L]:r<=this.size-(a.maxSize-a.snapOffset+this[x])&&(r=this.size-(a.maxSize+this[x])),Me.call(this,r),p(t,"onDrag",C)(J()))}function Ne(){var i=l[this.a].element,r=l[this.b].element,o=i[Ie](),a=r[Ie]();this.size=o[s]+a[s]+this[L]+this[x],this.start=o[u],this.end=o[m]}function _t(i){if(!getComputedStyle)return null;var r=getComputedStyle(i);if(!r)return null;var o=i[f];return o===0?null:(D===ie?o-=parseFloat(r.paddingLeft)+parseFloat(r.paddingRight):o-=parseFloat(r.paddingTop)+parseFloat(r.paddingBottom),o)}function Ge(i){var r=_t(v);if(r===null||A.reduce(function(d,E){return d+E},0)>r)return i;var o=0,a=[],S=i.map(function(d,E){var _=r*d/100,j=se(W,E===0,E===i.length-1,K),q=A[E]+j;return _<q?(o+=q-_,a.push(0),q):(a.push(_-q),_)});return o===0?i:S.map(function(d,E){var _=d;if(o>0&&a[E]-o>0){var j=Math.min(o,a[E]-o);o-=j,_=d-j}return _/r*100})}function Mt(){var i=this,r=l[i.a].element,o=l[i.b].element;i.dragging&&p(t,"onDragEnd",C)(J()),i.dragging=!1,w[T]("mouseup",i.stop),w[T]("touchend",i.stop),w[T]("touchcancel",i.stop),w[T]("mousemove",i.move),w[T]("touchmove",i.move),i.stop=null,i.move=null,r[T]("selectstart",C),r[T]("dragstart",C),o[T]("selectstart",C),o[T]("dragstart",C),r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",o.style.userSelect="",o.style.webkitUserSelect="",o.style.MozUserSelect="",o.style.pointerEvents="",i.gutter.style.cursor="",i.parent.style.cursor="",Y.body.style.cursor=""}function Nt(i){if(!("button"in i&&i.button!==0)){var r=this,o=l[r.a].element,a=l[r.b].element;r.dragging||p(t,"onDragStart",C)(J()),i.preventDefault(),r.dragging=!0,r.move=Rt.bind(r),r.stop=Mt.bind(r),w[O]("mouseup",r.stop),w[O]("touchend",r.stop),w[O]("touchcancel",r.stop),w[O]("mousemove",r.move),w[O]("touchmove",r.move),o[O]("selectstart",C),o[O]("dragstart",C),a[O]("selectstart",C),a[O]("dragstart",C),o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.MozUserSelect="none",a.style.pointerEvents="none",r.gutter.style.cursor=Se,r.parent.style.cursor=Se,Y.body.style.cursor=Se,Ne.call(r),r.dragOffset=_e(i)-r.end}}b=Ge(b);var R=[];l=n.map(function(i,r){var o={element:dt(i),size:b[r],minSize:A[r],maxSize:$[r],snapOffset:Ct[r],i:r},a;if(r>0&&(a={a:r-1,b:r,dragging:!1,direction:D,parent:v},a[L]=se(W,r-1===0,!1,K),a[x]=se(W,!1,r===n.length-1,K),G==="row-reverse"||G==="column-reverse")){var S=a.a;a.a=a.b,a.b=S}if(r>0){var d=It(r,D,o.element);At(d,W,r),a[U]=Nt.bind(a),d[O]("mousedown",a[U]),d[O]("touchstart",a[U]),v.insertBefore(d,o.element),a.gutter=d}return k(o.element,o.size,se(W,r===0,r===n.length-1,K),r),r>0&&R.push(a),o});function be(i){var r=i.i===R.length,o=r?R[i.i-1]:R[i.i];Ne.call(o);var a=r?o.size-i.minSize-o[x]:i.minSize+o[L];Me.call(o,a)}l.forEach(function(i){var r=i.element[Ie]()[s];r<i.minSize&&(fe?be(i):i.minSize=r)});function Gt(i){var r=Ge(i);r.forEach(function(o,a){if(a>0){var S=R[a-1],d=l[S.a],E=l[S.b];d.size=r[a-1],E.size=o,k(d.element,d.size,S[L],d.i),k(E.element,E.size,S[x],E.i)}})}function bt(i,r){R.forEach(function(o){if(r!==!0?o.parent.removeChild(o.gutter):(o.gutter[T]("mousedown",o[U]),o.gutter[T]("touchstart",o[U])),i!==!0){var a=Re(s,o.a.size,o[L]);Object.keys(a).forEach(function(S){l[o.a].element.style[S]="",l[o.b].element.style[S]=""})}})}return{setSizes:Gt,getSizes:J,collapse:function(r){be(l[r])},destroy:bt,parent:v,pairs:R}},St=kt;var Ht=`
<div class="circle-loader">
  <svg class="circular" viewBox="25 25 50 50">
  <circle
    class="path"
    cx="50"
    cy="50"
    r="20"
    fill="none"
    stroke-width="2"
    stroke-miterlimit="10"
  />
  </svg>
</div>
`;function pt(){M("isLoading",!0);let e=document.createElement("div");e.className="strigo-loader",e.innerHTML=Ht,document.body.appendChild(e)}function vt(){V(I()).hideLoader()}function Et(){return!!qe("isLoading")}function Ae(){let e=Le();if(e){g.info("Posting event",e),window.frames[0].postMessage(e,"*");let t=et();e.eventName!==t.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:e,poppedEvent:t})}}function wt(){for(;Le();)Ae()}var Ut={init:function(){g.info("overlay init called");let e=h();return e&&window.Strigo.setup(e),"OVERLAY"},setup:function({development:e,version:t}){g.info("overlay setup called"),oe({parentElement:ne(),url:Ue(e,t)});let n=ct(X(h()));this.initEventListeners(n)},shutdown:function(){g.info("overlay shutdown called"),lt(),Oe()},open:function(){ut()},hideLoader:function(){M("isLoading",!1),document.getElementById("strigo-widget").classList.add("slide-in"),document.getElementById("strigo-widget").classList.add("loaded")},initEventListeners:function(e){le(e),ce(),window.addEventListener("overlay-widget-event",t=>{ge(t?.detail)})}},ae=Ut;function ge({key:e,oldValue:t,newValue:n}){if(e!=="strigoEvents")return;let s=JSON.parse(n)?.events,c=JSON.parse(t)?.events;s.filter(({eventName:m})=>!c.some(({eventName:f})=>m===f)).length>0&&Ae()}function ce(){window.addEventListener("message",e=>{if(!(!e||!e.data))switch(e.data){case"close":{window.Strigo&&window.Strigo.shutdown();break}case"challenge-success":{g.info("Challenge event success received"),I()==="overlay"&&ae.open();break}default:break}},!1)}function le(e){e.addEventListener("load",()=>{Et()&&vt(),wt()})}var Yt={init:function(){let e;if(te())g.info("Child SDK window"),e="CHILD",window.dispatchEvent(new Event("strigo-opened"));else{g.info("Parent SDK window"),e="PARENT";let t=h();t&&window.Strigo.setup(t)}return e},setup:function({development:e,version:t}){g.info("iframe setup started"),rt(),oe({parentElement:ne(),url:Be(e,t)}),pt();let n=nt(),s=Ce({parentElement:n,url:X(h()),classNames:Pe,id:"strigo-exercises"});Ce({parentElement:n,url:h().initSite.href,classNames:Ve,id:"original-site"}),St(["#strigo-exercises","#original-site"],{sizes:[25,75],maxSize:st(),minSize:at(),gutterSize:2}),this.initEventListeners(s)},shutdown:function(){g.info("iframe shutdown called"),ot()},hideLoader:function(){let e=document.querySelector(".strigo-loader"),t=setInterval(()=>{e.style.opacity||(e.style.opacity="1");let n=parseFloat(e.style.opacity);n>0?e.style.opacity=(n-.1).toString():(M("isLoading",!1),e.style.pointerEvents="none",clearInterval(t))},200)},initEventListeners:function(e){le(e),ce(),window.addEventListener("storage",ge)}},Tt=Yt;function Lt(e){return e&&e==="dynamic"?gt()?"iframe":"overlay":e}function V(e){let t=null;switch(e){case"iframe":{t=Tt;break}case"overlay":{t=ae;break}default:g.error("widgetFlavor is not supported",{widgetFlavor:e});break}return t}var ue;(m=>{function t(){if(g.info("Started initialization"),Ze(),window.Strigo?.initialized)return;window.Strigo.initialized=!0;let f=V(I());if(!f){g.error("Can't finish initialization. widgetFlavor is not supported.");return}m.SDKType=f.init(),g.info("Finished initialization")}m.init=t;async function n(f,l){try{let v=await fetch(`${l?"http://localhost:3000":"https://app.strigo.io"}/api/internal/academy/v1/config`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f.token}`}});if(!v.ok)throw new Error(`Failed to fetch remote configuration: ${v.statusText}`);return(await v.json()).data}catch(y){g.warn("Error fetching configuration from Strigo",{err:y})}}async function s(f){let{email:l,token:y,development:v=!1,version:N}=f;if(!y){g.error("token is not defined - exiting setup");return}let G=await n(y,v);if(G){let{loggingConfig:fe}=G;g.debug("Configuration fetched from Strigo"),g.setup(fe)}if(m.SDKType==="CHILD"||m.SDKType==="OVERLAY"&&te()){g.info("panel is already opened");return}g.info("Started setup");let{webApiKey:b,subDomain:z,selectedWidgetFlavor:A}=He();if(!v&&(!l||!y||!b||!z||!A)){g.error("setup data missing - exiting setup");return}Ke({email:l,initSite:ke(),token:y,webApiKey:b,subDomain:z,development:v,version:N,selectedWidgetFlavor:A,loggingConfig:G?.loggingConfig});let F=Lt(A);je({currentUrl:h().initSite.href,isPanelOpen:!0,isLoading:!0,widgetFlavor:F});let $=V(F);if(!$){g.error("Can't finish setup. widgetFlavor is not supported.");return}$.setup({version:N,development:v}),g.info("Finished setup")}m.setup=s;function c(){if(g.info("Started shutdown"),m.SDKType==="CHILD")return window.parent.postMessage("close","*");let f=I();Je(),Xe();let l=V(f);if(!l){g.error("Can't finish shutdown. widgetFlavor is not supported.");return}l.shutdown(),g.info("Finished shutdown")}m.shutdown=c;function u(f){Qe({eventName:f}),g.debug("sendEvent called",{eventName:f})}m.sendEvent=u})(ue||(ue={}));window.Strigo=ue;window.Strigo.init();})();
