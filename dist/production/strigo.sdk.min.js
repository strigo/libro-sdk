(()=>{var be="strigo-sdk",ze="strigo.io",Pe="localhost:3000",Fe=["strigo-exercises"],Ve=["orig-iframe"],me=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"/></svg>
`,We=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"/></svg>
`,V="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk";function bt(t){let e={};for(let[n,i]of t)e[n]=i;return e}function ke(){let{host:t,pathname:e,href:n,origin:i,search:g}=window.location;return{host:t,pathName:e,href:n,origin:i,search:g,params:zt(g)}}function zt(t){let n=new URLSearchParams(t).entries();return bt(n)}function J(t){let{subDomain:e,token:n,webApiKey:i,development:g}=t;return g?`http://${Pe}/academy/courses?token=${n.token}&webApiKey=${i}`:`https://${e}.${ze}/academy/courses?token=${n.token}&webApiKey=${i}`}function He(){let t=document.getElementById(be);return{webApiKey:t?.getAttribute("data-web-api-key")||"",subDomain:t?.getAttribute("data-subdomain")||"",selectedWidgetFlavor:t?.getAttribute("data-layout-flavor")||"dynamic"}}function Ue(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:e?`${V}@${e}/dist/production/styles/strigo.min.css`:`${V}@master/dist/production/styles/strigo.min.css`}function Be(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo-widget.css`:e?`${V}@${e}/dist/production/styles/strigo-widget.min.css`:`${V}@master/dist/production/styles/strigo-widget.min.css`}var Ke=class{constructor(e){this.url=e?.url}setup(e){this.url=e.url}logToRemote(e,n,i){fetch(this.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:n,context:i})}).then(g=>{g.ok||console.warn("Logging to Strigo failed",{result:g})}).catch(g=>{console.warn("Logging to Strigo failed",{err:g})})}logToConsole(e,n,i){let g=`${new Date().toISOString()} - ${n}`;console[e](g,i?`
${JSON.stringify(i)}`:"")}getDefaultContext(){let e=h();if(!e)return{};let{token:n,subDomain:i,initSite:g,development:f,version:m,selectedWidgetFlavor:u}=e;return{token:n.token,initSite:g.href,subDomain:i,development:f,version:m,selectedWidgetFlavor:u}}log(e,n,i){let g={...this.getDefaultContext(),...i};try{this.url&&!h()?.development&&this.logToRemote(e,n,g),this.logToConsole(e,`Academy - ${n}`,g)}catch(f){console.log("Logging error:",{err:f})}}debug(e,n={}){this.log("debug",e,n)}info(e,n={}){this.log("info",e,n)}warn(e,n={}){this.log("warn",e,n)}error(e,n={}){this.log("error",e,n)}},c=new Ke;function W(t,e){try{return JSON.parse(window[t].getItem(e))}catch(n){return c.error("get storage data error",{err:n}),null}}function q(t,e,n){try{return window[t].setItem(e,JSON.stringify(n)),n}catch(i){return c.error("setup storage error",{err:i}),null}}function ve(t,e,n,i){try{let g=W(t,e);if(!g)throw new Error("Can't find initial state");let f={...g,[n]:i};return window[t].setItem(e,JSON.stringify(f)),f}catch(g){return c.error("set storage value error",{err:g}),null}}function X(t,e){try{window[t].removeItem(e)}catch(n){c.error("clear storage error",{err:n})}}function $e(t){return q("localStorage","strigoConfig",t)}function h(){return W("localStorage","strigoConfig")}function Je(){X("localStorage","strigoConfig")}function je(t){return q("sessionStorage","strigoSession",t)}function Z(){return he()?.isPanelOpen}function _(){return he()?.widgetFlavor}function he(){return W("sessionStorage","strigoSession")}function we(t,e){return ve("sessionStorage","strigoSession",t,e)}function qe(t){return he()?.[t]}function Xe(){X("sessionStorage","strigoSession")}function ye(){we("isPanelOpen",!1)}window.onunload=function(){ye()};function Ze(){try{let t=Q();if(t)return c.debug("Events storage already exists"),t;let e={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),e}catch(t){return c.error("Init events storage error",{error:t}),null}}function Q(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(t){return c.error("Get events storage error",{error:t}),null}}function Qe(t){try{let e=Q();if(!e)throw new Error("Can't find initial state");let n=JSON.stringify(e);if(e.events.push(t),window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),_()==="overlay"){let i=new CustomEvent("overlay-widget-event",{bubbles:!0,detail:{key:"strigoEvents",oldValue:n,newValue:JSON.stringify(e)}});window.dispatchEvent(i)}return e}catch(e){return c.error("Push event to storage error",{error:e}),null}}function et(){try{let t=Q();if(!t)throw new Error("Can't find events storage");let e=t.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),e}catch(t){return c.error("Pop event from storage error",{error:t}),null}}function Te(){try{let t=Q();if(!t)throw new Error("Can't find events storage");return t.events.pop()}catch(t){return c.error("Get event from storage error",{error:t}),null}}function ee(){return document.getElementsByTagName("head")[0]}function rt(){document.open(),document.close()}function nt(){let t=document.createElement("div");return t.className="strigo-main",document.body.appendChild(t),t}function te(t){let{url:e,parentElement:n}=t,i=document.createElement("link");i.rel="stylesheet",i.href=e,n.appendChild(i)}function Le(t){let{url:e,parentElement:n,classNames:i,id:g}=t,f=document.createElement("iframe");return f.classList.add(...i),f.id=g,f.src=e,n.appendChild(f),f}function ot(){location.reload()}function it(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function st(){return it()?[window.screen.width,window.screen.width]:[window.screen.width/2,window.screen.width]}function at(){return it()?[0,0]:[window.screen.width*.25,0]}function gt(){let t=new XMLHttpRequest;t.open("GET",window.document.location.href,!1),t.send(null);let n=t.getAllResponseHeaders().toLowerCase().split(`\r
`);for(let i of n)if(i.includes("x-frame-options")){let g=i.split(":");if(g&&g.length>1)return g[1].trim()!=="deny"}return!0}function ct(t){let e=function(){let u=document.getElementById("strigo-widget"),l=u.classList.contains("slide-in");u.classList.toggle("slide-in"),setTimeout(()=>{let y=document.getElementById("strigo-arrow");y.innerHTML=l?We:me},300)},n=document.createElement("div");n.className="strigo-arrow",n.id="strigo-arrow",n.innerHTML=me;let i=document.createElement("div");i.className="strigo-collapse-button",i.id="strigo-toggle",i.appendChild(n);let g=document.createElement("div");g.className="strigo-collapse-div",g.onclick=()=>{e()},g.appendChild(i);let f=document.createElement("iframe");f.className="strigo-iframe",f.id="strigo-exercises",f.src=t;let m=document.createElement("div");return m.className="strigo-widget",m.id="strigo-widget",m.appendChild(g),m.appendChild(f),document.body.appendChild(m),f}var lt=function(){document.getElementById("strigo-widget").remove()},ut=function(){let t=document.getElementById("strigo-widget");t.classList.contains("slide-in")||t.classList.add("slide-in")};var w=typeof window!="undefined"?window:null,Ce=w===null,U=Ce?void 0:w.document,O="addEventListener",T="removeEventListener",Ie="getBoundingClientRect",H="_a",L="_b",C="_c",re="horizontal",I=function(){return!1},Pt=Ce?"calc":["","-webkit-","-moz-","-o-"].filter(function(t){var e=U.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",mt=function(t){return typeof t=="string"||t instanceof String},dt=function(t){if(mt(t)){var e=U.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},p=function(t,e,n){var i=t[e];return i!==void 0?i:n},ne=function(t,e,n,i){if(e){if(i==="end")return 0;if(i==="center")return t/2}else if(n){if(i==="start")return 0;if(i==="center")return t/2}return t},Ft=function(t,e){var n=U.createElement("div");return n.className="gutter gutter-"+e,n},Vt=function(t,e,n){var i={};return mt(e)?i[t]=e:i[t]=Pt+"("+e+"% - "+n+"px)",i},Wt=function(t,e){var n;return n={},n[t]=e+"px",n},kt=function(t,e){if(e===void 0&&(e={}),Ce)return{};var n=t,i,g,f,m,u,l;Array.from&&(n=Array.from(n));var y=dt(n[0]),v=y.parentNode,N=getComputedStyle?getComputedStyle(v):null,G=N?N.flexDirection:null,M=p(e,"sizes")||n.map(function(){return 100/n.length}),D=p(e,"minSize",100),x=Array.isArray(D)?D:n.map(function(){return D}),b=p(e,"maxSize",1/0),Ae=Array.isArray(b)?b:n.map(function(){return b}),le=p(e,"expandToMin",!1),P=p(e,"gutterSize",10),B=p(e,"gutterAlign","center"),ue=p(e,"snapOffset",30),It=Array.isArray(ue)?ue:n.map(function(){return ue}),fe=p(e,"dragInterval",1),z=p(e,"direction",re),de=p(e,"cursor",z===re?"col-resize":"row-resize"),Ct=p(e,"gutter",Ft),Re=p(e,"elementStyle",Vt),xt=p(e,"gutterStyle",Wt);z===re?(i="width",g="clientX",f="left",m="right",u="clientWidth"):z==="vertical"&&(i="height",g="clientY",f="top",m="bottom",u="clientHeight");function F(s,r,o,a){var S=Re(i,r,o,a);Object.keys(S).forEach(function(d){s.style[d]=S[d]})}function At(s,r,o){var a=xt(i,r,o);Object.keys(a).forEach(function(S){s.style[S]=a[S]})}function K(){return l.map(function(s){return s.size})}function _e(s){return"touches"in s?s.touches[0][g]:s[g]}function Ne(s){var r=l[this.a],o=l[this.b],a=r.size+o.size;r.size=s/this.size*a,o.size=a-s/this.size*a,F(r.element,r.size,this[L],r.i),F(o.element,o.size,this[C],o.i)}function Rt(s){var r,o=l[this.a],a=l[this.b];!this.dragging||(r=_e(s)-this.start+(this[L]-this.dragOffset),fe>1&&(r=Math.round(r/fe)*fe),r<=o.minSize+o.snapOffset+this[L]?r=o.minSize+this[L]:r>=this.size-(a.minSize+a.snapOffset+this[C])&&(r=this.size-(a.minSize+this[C])),r>=o.maxSize-o.snapOffset+this[L]?r=o.maxSize+this[L]:r<=this.size-(a.maxSize-a.snapOffset+this[C])&&(r=this.size-(a.maxSize+this[C])),Ne.call(this,r),p(e,"onDrag",I)(K()))}function Ge(){var s=l[this.a].element,r=l[this.b].element,o=s[Ie](),a=r[Ie]();this.size=o[i]+a[i]+this[L]+this[C],this.start=o[f],this.end=o[m]}function _t(s){if(!getComputedStyle)return null;var r=getComputedStyle(s);if(!r)return null;var o=s[u];return o===0?null:(z===re?o-=parseFloat(r.paddingLeft)+parseFloat(r.paddingRight):o-=parseFloat(r.paddingTop)+parseFloat(r.paddingBottom),o)}function Me(s){var r=_t(v);if(r===null||x.reduce(function(d,E){return d+E},0)>r)return s;var o=0,a=[],S=s.map(function(d,E){var R=r*d/100,Y=ne(P,E===0,E===s.length-1,B),$=x[E]+Y;return R<$?(o+=$-R,a.push(0),$):(a.push(R-$),R)});return o===0?s:S.map(function(d,E){var R=d;if(o>0&&a[E]-o>0){var Y=Math.min(o,a[E]-o);o-=Y,R=d-Y}return R/r*100})}function Nt(){var s=this,r=l[s.a].element,o=l[s.b].element;s.dragging&&p(e,"onDragEnd",I)(K()),s.dragging=!1,w[T]("mouseup",s.stop),w[T]("touchend",s.stop),w[T]("touchcancel",s.stop),w[T]("mousemove",s.move),w[T]("touchmove",s.move),s.stop=null,s.move=null,r[T]("selectstart",I),r[T]("dragstart",I),o[T]("selectstart",I),o[T]("dragstart",I),r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",o.style.userSelect="",o.style.webkitUserSelect="",o.style.MozUserSelect="",o.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",U.body.style.cursor=""}function Gt(s){if(!("button"in s&&s.button!==0)){var r=this,o=l[r.a].element,a=l[r.b].element;r.dragging||p(e,"onDragStart",I)(K()),s.preventDefault(),r.dragging=!0,r.move=Rt.bind(r),r.stop=Nt.bind(r),w[O]("mouseup",r.stop),w[O]("touchend",r.stop),w[O]("touchcancel",r.stop),w[O]("mousemove",r.move),w[O]("touchmove",r.move),o[O]("selectstart",I),o[O]("dragstart",I),a[O]("selectstart",I),a[O]("dragstart",I),o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.MozUserSelect="none",a.style.pointerEvents="none",r.gutter.style.cursor=de,r.parent.style.cursor=de,U.body.style.cursor=de,Ge.call(r),r.dragOffset=_e(s)-r.end}}M=Me(M);var A=[];l=n.map(function(s,r){var o={element:dt(s),size:M[r],minSize:x[r],maxSize:Ae[r],snapOffset:It[r],i:r},a;if(r>0&&(a={a:r-1,b:r,dragging:!1,direction:z,parent:v},a[L]=ne(P,r-1===0,!1,B),a[C]=ne(P,!1,r===n.length-1,B),G==="row-reverse"||G==="column-reverse")){var S=a.a;a.a=a.b,a.b=S}if(r>0){var d=Ct(r,z,o.element);At(d,P,r),a[H]=Gt.bind(a),d[O]("mousedown",a[H]),d[O]("touchstart",a[H]),v.insertBefore(d,o.element),a.gutter=d}return F(o.element,o.size,ne(P,r===0,r===n.length-1,B),r),r>0&&A.push(a),o});function De(s){var r=s.i===A.length,o=r?A[s.i-1]:A[s.i];Ge.call(o);var a=r?o.size-s.minSize-o[C]:s.minSize+o[L];Ne.call(o,a)}l.forEach(function(s){var r=s.element[Ie]()[i];r<s.minSize&&(le?De(s):s.minSize=r)});function Mt(s){var r=Me(s);r.forEach(function(o,a){if(a>0){var S=A[a-1],d=l[S.a],E=l[S.b];d.size=r[a-1],E.size=o,F(d.element,d.size,S[L],d.i),F(E.element,E.size,S[C],E.i)}})}function Dt(s,r){A.forEach(function(o){if(r!==!0?o.parent.removeChild(o.gutter):(o.gutter[T]("mousedown",o[H]),o.gutter[T]("touchstart",o[H])),s!==!0){var a=Re(i,o.a.size,o[L]);Object.keys(a).forEach(function(S){l[o.a].element.style[S]="",l[o.b].element.style[S]=""})}})}return{setSizes:Mt,getSizes:K,collapse:function(r){De(l[r])},destroy:Dt,parent:v,pairs:A}},St=kt;var Ht=`
<div class="circle-loader">
  <svg class="circular" viewBox="25 25 50 50">
  <circle
    class="path"
    cx="50"
    cy="50"
    r="20"
    fill="none"
    stroke-width="2"
    stroke-miterlimit="10"
  />
  </svg>
</div>
`;function pt(){let t=document.createElement("div");t.className="strigo-loader",t.innerHTML=Ht,document.body.appendChild(t)}function vt(){let t=document.querySelector(".strigo-loader");return new Promise(e=>{let n=setInterval(()=>{t.style.opacity||(t.style.opacity="1");let i=parseFloat(t.style.opacity);i>0?t.style.opacity=(i-.1).toString():(t.style.pointerEvents="none",clearInterval(n),e())},200)})}function xe(){let t=Te();if(t){c.info("Posting event",t),window.frames[0].postMessage(t,"*");let e=et();t.eventName!==e.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:t,poppedEvent:e})}}function Et(){for(;Te();)xe()}function Bt(){document.getElementById("strigo-widget").classList.add("slide-in"),document.getElementById("strigo-widget").classList.add("loaded")}var wt=class{init(){c.info("overlay init called");let e=h();return e&&window.Strigo.setup(e),"OVERLAY"}setup({development:e,version:n}){c.info("overlay setup called"),te({parentElement:ee(),url:Be(e,n)});let i=ct(J(h()));this.initEventListeners(i)}shutdown(){c.info("overlay shutdown called"),lt(),ye()}open(){ut()}initEventListeners(e){ae(e,Bt),se(),window.addEventListener("overlay-widget-event",n=>{ie(n?.detail)})}},oe=new wt;function ie({key:t,oldValue:e,newValue:n}){if(t!=="strigoEvents")return;let i=JSON.parse(n)?.events,g=JSON.parse(e)?.events;i.filter(({eventName:m})=>!g.some(({eventName:u})=>m===u)).length>0&&xe()}function se(){window.addEventListener("message",t=>{if(!(!t||!t.data))switch(t.data){case"close":{window.Strigo&&window.Strigo.shutdown();break}case"challenge-success":{c.info("Challenge event success received"),_()==="overlay"&&oe.open();break}default:break}},!1)}function ae(t,e){t.addEventListener("load",async()=>{qe("isLoading")&&(e&&await e(),we("isLoading",!1)),Et()})}var Ot=class{init(){let e;if(Z())c.info("Child SDK window"),e="CHILD",window.dispatchEvent(new Event("strigo-opened"));else{c.info("Parent SDK window"),e="PARENT";let n=h();n&&window.Strigo.setup(n)}return e}setup({development:e,version:n}){c.info("iframe setup started"),rt(),te({parentElement:ee(),url:Ue(e,n)}),pt();let i=nt(),g=Le({parentElement:i,url:J(h()),classNames:Fe,id:"strigo-exercises"});Le({parentElement:i,url:h().initSite.href,classNames:Ve,id:"original-site"}),St(["#strigo-exercises","#original-site"],{sizes:[25,75],maxSize:st(),minSize:at(),gutterSize:2}),this.initEventListeners(g)}shutdown(){c.info("iframe shutdown called"),ot()}initEventListeners(e){ae(e,vt),se(),window.addEventListener("storage",ie)}},Tt=new Ot;function Lt(t){return t&&t==="dynamic"?gt()?"iframe":"overlay":t}function ge(t){let e=null;switch(t){case"iframe":{e=Tt;break}case"overlay":{e=oe;break}default:throw c.error("Widget flavor is not supported",{widgetFlavor:t}),new Error(`Widget flavor ${t} is not supported`)}return e}var ce;(m=>{function e(){try{if(c.info("Initializing SDK..."),Ze(),window.Strigo?.initialized)return;window.Strigo.initialized=!0;let u=ge(_());m.SDKType=u.init(),c.info("Initialized SDK.")}catch(u){c.error("Could not initialize SDK",{err:u})}}m.init=e;async function n(u,l){try{let v=await fetch(`${l?"http://localhost:3000":"https://app.strigo.io"}/api/internal/academy/v1/config`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u.token}`}});if(!v.ok)throw new Error(`Failed to fetch remote configuration: ${v.statusText}`);return(await v.json()).data}catch(y){c.warn("Error fetching configuration from Strigo",{err:y})}}async function i(u){try{c.info("Starting to setup SDK...");let{email:l,token:y,development:v=!1,version:N}=u;if(!y)throw new Error("Token is not defined");let G=await n(y,v);if(G){let{loggingConfig:le}=G;c.debug("Configuration fetched from Strigo"),c.setup(le)}if(m.SDKType==="CHILD"||m.SDKType==="OVERLAY"&&Z()){c.info("panel is already opened");return}let{webApiKey:M,subDomain:D,selectedWidgetFlavor:x}=He();if(!v&&(!l||!y||!M||!D||!x))throw new Error("Setup data is missing");$e({email:l,initSite:ke(),token:y,webApiKey:M,subDomain:D,development:v,version:N,selectedWidgetFlavor:x,loggingConfig:G?.loggingConfig});let b=Lt(x);je({currentUrl:h().initSite.href,isPanelOpen:!0,isLoading:!0,widgetFlavor:b}),ge(b).setup({version:N,development:v}),c.info("Finished SDK setup.")}catch(l){c.error("Could not setup SDK",{err:l})}}m.setup=i;function g(){try{if(c.info("Shutting down SDK..."),m.SDKType==="CHILD"){window.parent.postMessage("close","*");return}let u=ge(_());Je(),Xe(),u.shutdown(),c.info("Finished SDK shutdown.")}catch(u){c.error("Could not shutdown SDK",{err:u})}}m.shutdown=g;function f(u){Qe({eventName:u}),c.debug("sendEvent called",{eventName:u})}m.sendEvent=f})(ce||(ce={}));window.Strigo=ce;window.Strigo.init();})();
