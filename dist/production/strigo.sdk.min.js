(()=>{var Me="strigo-sdk",Ge="strigo.io",Ne="localhost:3000",be=["strigo-exercises"],ze=["orig-iframe"],ue=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"/></svg>
`,Pe=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"/></svg>
`,G="https://cdn.jsdelivr.net/gh/strigo/strigo-sdk";function Pt(t){let e={};for(let[r,o]of t)e[r]=o;return e}function Ft(t){let r=new URLSearchParams(t).entries();return Pt(r)}function Fe(){let{host:t,pathname:e,href:r,origin:o,search:g}=window.location;return{host:t,pathName:e,href:r,origin:o,search:g,params:Ft(g)}}function K(t){let{subDomain:e,token:r,webApiKey:o,development:g}=t;return g?`http://${Ne}/academy/courses?token=${r.token}&webApiKey=${o}`:`https://${e}.${Ge}/academy/courses?token=${r.token}&webApiKey=${o}`}function We(){let t=document.getElementById(Me);return{webApiKey:t?.getAttribute("data-web-api-key")||"",subDomain:t?.getAttribute("data-subdomain")||"",selectedWidgetFlavor:t?.getAttribute("data-layout-flavor")||"dynamic"}}function Ve(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo.css`:e?`${G}@${e}/dist/production/styles/strigo.min.css`:`${G}@master/dist/production/styles/strigo.min.css`}function ke(t,e){return t?`http://localhost:${SDK_HOSTING_PORT}/styles/strigo-widget.css`:e?`${G}@${e}/dist/production/styles/strigo-widget.min.css`:`${G}@master/dist/production/styles/strigo-widget.min.css`}var He=class{constructor(e){this.url=e?.url}setup(e){this.url=e.url}logToRemote(e,r,o){return fetch(this.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:r,context:o})}).then(g=>{g.ok||console.warn("Logging to Strigo failed",{result:g})}).catch(g=>{console.warn("Logging to Strigo failed",{err:g})})}logToConsole(e,r,o){let g=`${new Date().toISOString()} - ${r}`;console[e](g,o?`
${JSON.stringify(o)}`:"")}getDefaultContext(){let e=p();if(!e)return{};let{token:r,subDomain:o,initSite:g,development:l,version:E,selectedWidgetFlavor:O}=e;return{token:r.token,initSite:g.href,subDomain:o,development:l,version:E,selectedWidgetFlavor:O}}log(e,r,o){let g={...this.getDefaultContext(),...o};try{this.url&&!p()?.development&&this.logToRemote(e,r,g),this.logToConsole(e,`Academy - ${r}`,g)}catch(l){console.log("Logging error:",{err:l})}}debug(e,r={}){this.log("debug",e,r)}info(e,r={}){this.log("info",e,r)}warn(e,r={}){this.log("warn",e,r)}error(e,r={}){this.log("error",e,r)}},c=new He;function N(t,e){try{return JSON.parse(window[t].getItem(e))}catch(r){return c.error("get storage data error",{err:r}),null}}function B(t,e,r){try{return window[t].setItem(e,JSON.stringify(r)),r}catch(o){return c.error("setup storage error",{err:o}),null}}function Se(t,e,r,o){try{let g=N(t,e);if(!g)throw new Error("Can't find initial state");let l={...g,[r]:o};return window[t].setItem(e,JSON.stringify(l)),l}catch(g){return c.error("set storage value error",{err:g}),null}}function Y(t,e){try{window[t].removeItem(e)}catch(r){c.error("clear storage error",{err:r})}}function Ue(t){return B("localStorage","strigoConfig",t)}function p(){return N("localStorage","strigoConfig")}function Be(){Y("localStorage","strigoConfig")}async function Ye(t,e){try{let o=await fetch(`${e?"http://localhost:3000":"https://app.strigo.io"}/api/internal/academy/v1/config`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}});if(!o.ok)throw new Error(`Failed to fetch remote configuration: ${o.statusText}`);return(await o.json()).data}catch(r){return c.warn("Error fetching configuration from Strigo",{err:r}),null}}function $e(t){return B("sessionStorage","strigoSession",t)}function ve(){return N("sessionStorage","strigoSession")}function $(){return ve()?.isPanelOpen}function x(){return ve()?.widgetFlavor}function Ee(t,e){return Se("sessionStorage","strigoSession",t,e)}function Je(t){return ve()?.[t]}function je(){Y("sessionStorage","strigoSession")}function he(){Ee("isPanelOpen",!1)}window.onunload=function(){he()};function J(){try{return JSON.parse(window["localStorage"].getItem("strigoEvents"))}catch(t){return c.error("Get events storage error",{error:t}),null}}function qe(){try{let t=J();if(t)return c.debug("Events storage already exists"),t;let e={events:[]};return window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),e}catch(t){return c.error("Init events storage error",{error:t}),null}}function Xe(t){try{let e=J();if(!e)throw new Error("Can't find initial state");let r=JSON.stringify(e);if(e.events.push(t),window["localStorage"].setItem("strigoEvents",JSON.stringify(e)),x()==="overlay"){let o=new CustomEvent("overlay-widget-event",{bubbles:!0,detail:{key:"strigoEvents",oldValue:r,newValue:JSON.stringify(e)}});window.dispatchEvent(o)}return e}catch(e){return c.error("Push event to storage error",{error:e}),null}}function Ze(){try{let t=J();if(!t)throw new Error("Can't find events storage");let e=t.events.pop();return window["localStorage"].setItem("strigoEvents",JSON.stringify(t)),e}catch(t){return c.error("Pop event from storage error",{error:t}),null}}function ye(){try{let t=J();if(!t)throw new Error("Can't find events storage");return t.events.pop()}catch(t){return c.error("Get event from storage error",{error:t}),null}}function j(){return document.getElementsByTagName("head")[0]}function et(){document.open(),document.close()}function tt(){let t=document.createElement("div");return t.className="strigo-main",document.body.appendChild(t),t}function q(t){let{url:e,parentElement:r}=t,o=document.createElement("link");o.rel="stylesheet",o.href=e,r.appendChild(o)}function Te(t){let{url:e,parentElement:r,classNames:o,id:g}=t,l=document.createElement("iframe");return l.classList.add(...o),l.id=g,l.src=e,r.appendChild(l),l}function rt(){location.reload()}function nt(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function ot(){return nt()?[window.screen.width,window.screen.width]:[window.screen.width/2,window.screen.width]}function it(){return nt()?[0,0]:[window.screen.width*.25,0]}function st(){let t=new XMLHttpRequest;t.open("GET",window.document.location.href,!1),t.send(null);let r=t.getAllResponseHeaders().toLowerCase().split(`\r
`);for(let o of r)if(o.includes("x-frame-options")){let g=o.split(":");if(g&&g.length>1)return g[1].trim()!=="deny"}return!0}function Wt(){let t=document.getElementById("strigo-widget"),e=t.classList.contains("slide-in");t.classList.toggle("slide-in"),setTimeout(()=>{let r=document.getElementById("strigo-arrow");r.innerHTML=e?Pe:ue},300)}function at(t){let e=document.createElement("div");e.className="strigo-arrow",e.id="strigo-arrow",e.innerHTML=ue;let r=document.createElement("div");r.className="strigo-collapse-button",r.id="strigo-toggle",r.appendChild(e);let o=document.createElement("div");o.className="strigo-collapse-div",o.onclick=()=>{Wt()},o.appendChild(r);let g=document.createElement("iframe");g.className="strigo-iframe",g.id="strigo-exercises",g.src=t;let l=document.createElement("div");return l.id="strigo-widget",l.appendChild(o),l.appendChild(g),document.body.appendChild(l),g}function gt(){document.getElementById("strigo-widget").remove()}function ct(){let t=document.getElementById("strigo-widget");t.classList.contains("slide-in")||t.classList.add("slide-in")}var v=typeof window!="undefined"?window:null,Le=v===null,P=Le?void 0:v.document,h="addEventListener",w="removeEventListener",Oe="getBoundingClientRect",z="_a",y="_b",L="_c",X="horizontal",T=function(){return!1},Vt=Le?"calc":["","-webkit-","-moz-","-o-"].filter(function(t){var e=P.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",ut=function(t){return typeof t=="string"||t instanceof String},dt=function(t){if(ut(t)){var e=P.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},m=function(t,e,r){var o=t[e];return o!==void 0?o:r},Z=function(t,e,r,o){if(e){if(o==="end")return 0;if(o==="center")return t/2}else if(r){if(o==="start")return 0;if(o==="center")return t/2}return t},kt=function(t,e){var r=P.createElement("div");return r.className="gutter gutter-"+e,r},Ht=function(t,e,r){var o={};return ut(e)?o[t]=e:o[t]=Vt+"("+e+"% - "+r+"px)",o},Kt=function(t,e){var r;return r={},r[t]=e+"px",r},Ut=function(t,e){if(e===void 0&&(e={}),Le)return{};var r=t,o,g,l,E,O,d;Array.from&&(r=Array.from(r));var _=dt(r[0]),I=_.parentNode,oe=getComputedStyle?getComputedStyle(I):null,F=oe?oe.flexDirection:null,ie=m(e,"sizes")||r.map(function(){return 100/r.length}),se=m(e,"minSize",100),ae=Array.isArray(se)?se:r.map(function(){return se}),ge=m(e,"maxSize",1/0),It=Array.isArray(ge)?ge:r.map(function(){return ge}),Ct=m(e,"expandToMin",!1),D=m(e,"gutterSize",10),W=m(e,"gutterAlign","center"),ce=m(e,"snapOffset",30),Rt=Array.isArray(ce)?ce:r.map(function(){return ce}),le=m(e,"dragInterval",1),A=m(e,"direction",X),de=m(e,"cursor",A===X?"col-resize":"row-resize"),xt=m(e,"gutter",kt),Ce=m(e,"elementStyle",Ht),At=m(e,"gutterStyle",Kt);A===X?(o="width",g="clientX",l="left",E="right",O="clientWidth"):A==="vertical"&&(o="height",g="clientY",l="top",E="bottom",O="clientHeight");function M(s,n,i,a){var f=Ce(o,n,i,a);Object.keys(f).forEach(function(u){s.style[u]=f[u]})}function _t(s,n,i){var a=At(o,n,i);Object.keys(a).forEach(function(f){s.style[f]=a[f]})}function V(){return d.map(function(s){return s.size})}function Re(s){return"touches"in s?s.touches[0][g]:s[g]}function xe(s){var n=d[this.a],i=d[this.b],a=n.size+i.size;n.size=s/this.size*a,i.size=a-s/this.size*a,M(n.element,n.size,this[y],n.i),M(i.element,i.size,this[L],i.i)}function Dt(s){var n,i=d[this.a],a=d[this.b];!this.dragging||(n=Re(s)-this.start+(this[y]-this.dragOffset),le>1&&(n=Math.round(n/le)*le),n<=i.minSize+i.snapOffset+this[y]?n=i.minSize+this[y]:n>=this.size-(a.minSize+a.snapOffset+this[L])&&(n=this.size-(a.minSize+this[L])),n>=i.maxSize-i.snapOffset+this[y]?n=i.maxSize+this[y]:n<=this.size-(a.maxSize-a.snapOffset+this[L])&&(n=this.size-(a.maxSize+this[L])),xe.call(this,n),m(e,"onDrag",T)(V()))}function Ae(){var s=d[this.a].element,n=d[this.b].element,i=s[Oe](),a=n[Oe]();this.size=i[o]+a[o]+this[y]+this[L],this.start=i[l],this.end=i[E]}function Mt(s){if(!getComputedStyle)return null;var n=getComputedStyle(s);if(!n)return null;var i=s[O];return i===0?null:(A===X?i-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight):i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom),i)}function _e(s){var n=Mt(I);if(n===null||ae.reduce(function(u,S){return u+S},0)>n)return s;var i=0,a=[],f=s.map(function(u,S){var R=n*u/100,k=Z(D,S===0,S===s.length-1,W),H=ae[S]+k;return R<H?(i+=H-R,a.push(0),H):(a.push(R-H),R)});return i===0?s:f.map(function(u,S){var R=u;if(i>0&&a[S]-i>0){var k=Math.min(i,a[S]-i);i-=k,R=u-k}return R/n*100})}function Gt(){var s=this,n=d[s.a].element,i=d[s.b].element;s.dragging&&m(e,"onDragEnd",T)(V()),s.dragging=!1,v[w]("mouseup",s.stop),v[w]("touchend",s.stop),v[w]("touchcancel",s.stop),v[w]("mousemove",s.move),v[w]("touchmove",s.move),s.stop=null,s.move=null,n[w]("selectstart",T),n[w]("dragstart",T),i[w]("selectstart",T),i[w]("dragstart",T),n.style.userSelect="",n.style.webkitUserSelect="",n.style.MozUserSelect="",n.style.pointerEvents="",i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",P.body.style.cursor=""}function Nt(s){if(!("button"in s&&s.button!==0)){var n=this,i=d[n.a].element,a=d[n.b].element;n.dragging||m(e,"onDragStart",T)(V()),s.preventDefault(),n.dragging=!0,n.move=Dt.bind(n),n.stop=Gt.bind(n),v[h]("mouseup",n.stop),v[h]("touchend",n.stop),v[h]("touchcancel",n.stop),v[h]("mousemove",n.move),v[h]("touchmove",n.move),i[h]("selectstart",T),i[h]("dragstart",T),a[h]("selectstart",T),a[h]("dragstart",T),i.style.userSelect="none",i.style.webkitUserSelect="none",i.style.MozUserSelect="none",i.style.pointerEvents="none",a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.MozUserSelect="none",a.style.pointerEvents="none",n.gutter.style.cursor=de,n.parent.style.cursor=de,P.body.style.cursor=de,Ae.call(n),n.dragOffset=Re(s)-n.end}}ie=_e(ie);var C=[];d=r.map(function(s,n){var i={element:dt(s),size:ie[n],minSize:ae[n],maxSize:It[n],snapOffset:Rt[n],i:n},a;if(n>0&&(a={a:n-1,b:n,dragging:!1,direction:A,parent:I},a[y]=Z(D,n-1===0,!1,W),a[L]=Z(D,!1,n===r.length-1,W),F==="row-reverse"||F==="column-reverse")){var f=a.a;a.a=a.b,a.b=f}if(n>0){var u=xt(n,A,i.element);_t(u,D,n),a[z]=Nt.bind(a),u[h]("mousedown",a[z]),u[h]("touchstart",a[z]),I.insertBefore(u,i.element),a.gutter=u}return M(i.element,i.size,Z(D,n===0,n===r.length-1,W),n),n>0&&C.push(a),i});function De(s){var n=s.i===C.length,i=n?C[s.i-1]:C[s.i];Ae.call(i);var a=n?i.size-s.minSize-i[L]:s.minSize+i[y];xe.call(i,a)}d.forEach(function(s){var n=s.element[Oe]()[o];n<s.minSize&&(Ct?De(s):s.minSize=n)});function bt(s){var n=_e(s);n.forEach(function(i,a){if(a>0){var f=C[a-1],u=d[f.a],S=d[f.b];u.size=n[a-1],S.size=i,M(u.element,u.size,f[y],u.i),M(S.element,S.size,f[L],S.i)}})}function zt(s,n){C.forEach(function(i){if(n!==!0?i.parent.removeChild(i.gutter):(i.gutter[w]("mousedown",i[z]),i.gutter[w]("touchstart",i[z])),s!==!0){var a=Ce(o,i.a.size,i[y]);Object.keys(a).forEach(function(f){d[i.a].element.style[f]="",d[i.b].element.style[f]=""})}})}return{setSizes:bt,getSizes:V,collapse:function(n){De(d[n])},destroy:zt,parent:I,pairs:C}},ft=Ut;var Bt=`
<div class="circle-loader">
  <svg class="circular" viewBox="25 25 50 50">
  <circle
    class="path"
    cx="50"
    cy="50"
    r="20"
    fill="none"
    stroke-width="2"
    stroke-miterlimit="10"
  />
  </svg>
</div>
`;function mt(){let t=document.createElement("div");t.id="strigo-loader",t.innerHTML=Bt,document.body.appendChild(t)}function St(){document.querySelector("#strigo-loader").classList.add("loaded")}function Ie(){let t=ye();if(t){c.info("Posting event",t),window.frames[0].postMessage(t,"*");let e=Ze();t.eventName!==e.eventName&&console.error("Events storage error: popped event doesn't match new event",{newEvent:t,poppedEvent:e})}}function pt(){for(;ye();)Ie()}function $t(){document.getElementById("strigo-widget").classList.add("slide-in"),document.getElementById("strigo-widget").classList.add("loaded")}var Et=class{init(){c.info("overlay init called");let e=p();return e&&window.Strigo.setup(e),"OVERLAY"}setup({development:e,version:r}){c.info("overlay setup called"),q({parentElement:j(),url:ke(e,r)});let o=at(K(p()));this.initEventListeners(o)}shutdown(){c.info("overlay shutdown called"),gt(),he()}open(){ct()}initEventListeners(e){re(e,$t),te(),window.addEventListener("overlay-widget-event",r=>{ee(r?.detail)})}},Q=new Et;function ee({key:t,oldValue:e,newValue:r}){if(t!=="strigoEvents")return;let o=JSON.parse(r)?.events,g=JSON.parse(e)?.events;o.filter(({eventName:E})=>!g.some(({eventName:O})=>E===O)).length>0&&Ie()}function te(){window.addEventListener("message",t=>{if(!(!t||!t.data))switch(t.data){case"close":{window.Strigo?.shutdown();break}case"challenge-success":{c.info("Challenge event success received"),x()==="overlay"&&Q.open();break}default:break}},!1)}function re(t,e){t.addEventListener("load",async()=>{Je("isLoading")&&(e&&await e(),Ee("isLoading",!1)),pt()})}var wt=class{init(){let e;if($())c.info("Child SDK window"),e="CHILD",window.dispatchEvent(new Event("strigo-opened"));else{c.info("Parent SDK window"),e="PARENT";let r=p();r&&window.Strigo.setup(r)}return e}setup({development:e,version:r}){c.info("iframe setup started"),et(),q({parentElement:j(),url:Ve(e,r)}),mt();let o=tt(),g=Te({parentElement:o,url:K(p()),classNames:be,id:"strigo-exercises"});Te({parentElement:o,url:p().initSite.href,classNames:ze,id:"original-site"}),ft(["#strigo-exercises","#original-site"],{sizes:[25,75],maxSize:ot(),minSize:it(),gutterSize:2}),this.initEventListeners(g)}shutdown(){c.info("iframe shutdown called"),rt()}initEventListeners(e){re(e,St),te(),window.addEventListener("storage",ee)}},yt=new wt;function Tt(t){return t&&t==="dynamic"?st()?"iframe":"overlay":t}function ne(t){let e=null;switch(t){case"iframe":{e=yt;break}case"overlay":{e=Q;break}default:throw c.error("Widget flavor is not supported",{widgetFlavor:t}),new Error(`Widget flavor ${t} is not supported`)}return e}var Ot=class{constructor(){this.initialized=!1;this.sdkType=void 0}init(){try{if(c.info("Initializing SDK..."),qe(),this.initialized)return;this.initialized=!0;let e=ne(x());this.sdkType=e.init(),c.info("Initialized SDK.")}catch(e){c.error("Could not initialize SDK",{err:e})}}async setup(e){try{c.info("Starting to setup SDK...");let{email:r,token:o,development:g=!1,version:l}=e;if(!o)throw new Error("Token is not defined");let E=await Ye(o,g);if(E){let{loggingConfig:F}=E;c.debug("Configuration fetched from Strigo"),c.setup(F)}if(this.sdkType==="CHILD"||this.sdkType==="OVERLAY"&&$()){c.info("panel is already opened");return}let{webApiKey:O,subDomain:d,selectedWidgetFlavor:_}=We();if(!g&&(!r||!o||!O||!d||!_))throw new Error("Setup data is missing");Ue({email:r,initSite:Fe(),token:o,webApiKey:O,subDomain:d,development:g,version:l,selectedWidgetFlavor:_,loggingConfig:E?.loggingConfig});let I=Tt(_);$e({currentUrl:p().initSite.href,isPanelOpen:!0,isLoading:!0,widgetFlavor:I}),ne(I).setup({version:l,development:g}),c.info("Finished SDK setup.")}catch(r){c.error("Could not setup SDK",{err:r})}}shutdown(){try{if(c.info("Shutting down SDK..."),this.sdkType==="CHILD"){window.parent.postMessage("close","*");return}let e=ne(x());Be(),je(),e.shutdown(),c.info("Finished SDK shutdown.")}catch(e){c.error("Could not shutdown SDK",{err:e})}}sendEvent(e){Xe({eventName:e}),c.debug("sendEvent called",{eventName:e})}},Lt=new Ot;window.Strigo=Lt;window.Strigo.init();})();
